<link href="https://cdn.jsdelivr.net/npm/tom-select@2.3.1/dist/css/tom-select.css" rel="stylesheet">
<style>
    
    *
    {
      margin: 0;
      padding: 0;
      font-family: "montserrat", sans-serif;
    }
    
    .testimonials
    {
      padding: 40px 0;
      background: #f1f1f1;
      color: #434343;
      text-align: center;
    }
    
    .testimonial-inner
    {
      max-width: 1200px;
      margin: auto;
      overflow: hidden;
      padding: 0 20px;
    }
    
    .border
    {
      width: 160px;
      height: 5px;
      background: #6ab04c;
      margin: 26px auto;
    }
    
    .row
    {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
    }
    
    .col
    {
      flex: 33.33%;
      max-width: 33.33%;
      box-sizing:  border-box;
      padding: 15px;
    }
    
    .testimonial
    {
      background: #fff;
      padding: 30px;
    }
    
    .testimonial img
    {
      width: 100px;
      height: 100px;
      background-position: 50% 50%;
          background-size: cover;
          background-repeat: no-repeat;
     
    }
    
    .name
    {
      font-size: 20px;
      text-transform: uppercase;
      margin: 20px 0;
    }
    
    .stars
    {
      color: #f0932b;
      margin-bottom: 20px;
    }
    
    @media screen and (max-width: 960px)
    {
      .col
      {
        flex: 100%;
        max-width: 80%;
      }
    }
  
  
  
    *{
      outline:none;
    }
    /* spacer */
    .spacer{
      height:150px;
      width:100%;
    }
    .spacer2{
      height:20px;
      width:100%;
    }
    /* spacer ends */
    
    /* slider styles */
    .sd_master_wrapper{
      position: relative;	
      max-width:900px;
      margin:0 auto;
      padding:0;
      border-radius:10px;
     
    }
    .sdtestBg3{
      height: 100%;
        width: 80%;
        background: #fff;
        position: absolute;
        bottom: -40px;
        left: 10%;
        border-radius: 20px;
        box-shadow: 0px 18px 52.8537px rgb(215 228 249 / 50%);
      z-index:1;
    }
    .sdtestBg2{
      height: 100%;
        width: 90%;
        background: #fff;
        position: absolute;
        bottom: -22px;
        left: 5%;
        border-radius: 20px;
        box-shadow: 0px 18px 52.8537px rgb(215 228 249 / 50%);
      z-index:2;
    }
    
    .sd_scroll {
      height: auto;
        max-height: 180px;
        overflow: auto;
    }
      
    .slideshow {
        position: relative;
        min-height: 300px;
        height: auto;
        background: #fff;
        box-shadow: 0px 18px 52.8537px rgba(215, 228, 249, 0.5);
        border-radius: 20px;
        background-image: url(https://farsighttechnologies.com/wp-content/uploads/2021/03/quote1.png), url(https://farsighttechnologies.com/wp-content/uploads/2021/03/quote.png);
        background-position: top 15px left 15px, bottom 40% right 15px;
        background-repeat: no-repeat;
        background-size: 180px, 180px;
      z-index:3;
    }
</style>

<style >
    .table-wrapper {
          background: #fff;
          padding: 20px 25px;
          margin: 30px 0;
          border-radius: 3px;
          box-shadow: 0 1px 1px rgba(0,0,0,.05);
      }
      .table-title {
          padding-bottom: 15px;
          background: #435d7d;
          color: #fff;
          padding: 16px 30px;
          margin: -20px -25px 10px;
          border-radius: 3px 3px 0 0;
      }
      .table-title h2 {
          margin: 5px 0 0;
          font-size: 24px;
      }
      .table-title .btn-group {
          float: right;
      }
      .table-title .btn {
          color: #fff;
          float: right;
          font-size: 13px;
          border: none;
          min-width: 50px;
          border-radius: 2px;
          border: none;
          outline: none !important;
          margin-left: 10px;
      }
      .table-title .btn i {
          float: left;
          font-size: 21px;
          margin-right: 5px;
      }
      .table-title .btn span {
          float: left;
          margin-top: 2px;
      }
      table.table tr th, table.table tr td {
          border-color: #e9e9e9;
          padding: 12px 15px;
          vertical-align: middle;
      }
      table.table tr th:first-child {
          width: 60px;
      }
      table.table tr th:last-child {
          width: 100px;
      }
      table.table-striped tbody tr:nth-of-type(odd) {
          background-color: #fcfcfc;
      }
      table.table-striped.table-hover tbody tr:hover {
          background: #f5f5f5;
      }
      table.table th i {
          font-size: 13px;
          margin: 0 5px;
          cursor: pointer;
      }
      table.table td:last-child i {
          opacity: 0.9;
          font-size: 22px;
          margin: 0 5px;
      }
      table.table td a {
          font-weight: bold;
          color: #566787;
          display: inline-block;
          text-decoration: none;
          outline: none !important;
      }
      table.table td a:hover {
          color: #2196F3;
      }
      table.table td a.edit {
          color: #FFC107;
      }
      table.table td a.delete {
          color: #F44336;
      }
      table.table td i {
          font-size: 19px;
      }
      table.table .avatar {
          border-radius: 50%;
          vertical-align: middle;
          margin-right: 10px;
      }
      .pagination {
          float: right;
          margin: 0 0 5px;
      }
      .pagination li a {
          border: none;
          font-size: 13px;
          min-width: 30px;
          min-height: 30px;
          color: #999;
          margin: 0 2px;
          line-height: 30px;
          border-radius: 2px !important;
          text-align: center;
          padding: 0 6px;
      }
      .pagination li a:hover {
          color: #666;
      }
      .pagination li.active a, .pagination li.active a.page-link {
          background: #03A9F4;
      }
      .pagination li.active a:hover {
          background: #0397d6;
      }
      .pagination li.disabled i {
          color: #ccc;
      }
      .pagination li i {
          font-size: 16px;
          padding-top: 6px
      }
      .hint-text {
          float: left;
          margin-top: 10px;
          font-size: 13px;
      }
      


  </style>
{% extends './entities.html' %}
{% load static %}

{% block add_title %} 
{{base_val}}
{% endblock %}


{% block semaines_operations %}
<div class="px-4 col-12  col-md-4" style="min-width:300px;max-height:350px;overflow:auto;">
    <div class="h5"> {{actual_institution.default_subperiod.m_periode}} </div>
    <div>
        {% for s in searches %}
        {% for val in s.values %}
        <div class=" mb-2"> <a href="/taches/{{base_val.id}}/{{forloop.counter}}" class="btn btn-light">{{val}}</a> </div>
        {% endfor %}
    </select>
    {% endfor %}
</div>
</div>
{% endblock %}



{% block table %}
{% block caption_table %} {% endblock %}
<div class="container">
    <div class="card">
      <div class="card-body">
        <div class="row">
            
          <div class="col-sm-12">
            <h5 style="font-weight: bold;">LISTE DES OPERATIONS</h5>
          </div>
          <!-- <div class="col-sm-4">
            <form action="/delete_selected_operations/" method="POST">  
                {% csrf_token %}  
            <button class="btn btn-danger" type="submit"><i class="fa fa-trash"></i>&nbsp; Tous Supprimer</button>
          
            </div> -->
        </div>
      </div>
<table class="table table-hover table-responsive  " id="tache" >
    <thead id='thead_tache'>
        {% block fields %}
        <tr role="row">
            <th>Code</th>
            <th>Nom {{actual_institution.operations_name}}</th>
            {% if actual_institution.default_options == False %}
            {% for th in actual_institution.operations_modules.fields %}
            <th class="sorting" tabindex="0" aria-controls="tache"  aria-label="Tache: activate to sort column ascending" style="">
                {{th}}
            </th>
            {% endfor %}
            {% endif %}
            <th>P&eacute;riode</th>
            <th>Personnel</th>
            {% if False %}<th>Chronogramme</th> {% else %} <th> Rapports </th> {% endif %}
            {% if actual_institution.default_options == False %}
            <!--
            {% for th in actual_institution.operations_modules.fill_fields_rapp %}
            <th class="sorting text-primary" tabindex="0" aria-controls="tache"  aria-label="Tache: activate to sort column ascending" style=" ">
                {% if th.type != 'choix' %} {{th.field}} {% else %} {{th.extras}} {% endif %} 
            </th>
            {% endfor %} -->
            {% else %}
            <th> Priorit&eacute;</th>
            <th> Montant </th>
            <th> Rapport Technique </th>
            {% endif %}
            <th>Actions</th>
            <th> Date </th>
        </tr>
        {% endblock %}
    </thead>
    <tbody id='tbody_tache'>
        {% block tbody %}
        {% for line in lines %}
        <tr>
            
        </form>
        <td>{{line.code}}</td>
            <!-- <th><input type="checkbox" class="entity_chbox" name="" value="{{line.id}}"></th> -->
            <td style="cursor:pointer;" onclick="document.location='/operations/details/{{line.id}}/';" class="t_cell table-hover">{{line}}</td>
            {% if actual_institution.default_options == False %}
            {% for th in line.values_spl1 %}
            <td onclick="document.location='/operations/details/{{line.id}}/';" class="sorting t_cell value_liner" tabindex="0" aria-controls="tache"  aria-label="Tache: activate to sort column ascending" style="">
                {{th}}
            </td>
            {% endfor %}
            {% endif %}

            <td onclick="document.location='/operations/details/{{line.id}}/';" class="t_cell planni_life" data-id="{{line.m_tache_plannification}}">{% if line.m_tache_plannification != None %}{{line.m_tache_plannification}}{% else %} Par DÃ©faut {% endif %}</td>

            <td class="t_cell" style="max-height:120px;overflow:auto;" {% if line.personnel != None %} data-id="{{line.personnel.id}}" {% else %} data-id="0" {% endif %}>{% if line.is_RACI == 0 %}
                {% if line.personnel != None %}
                <div><b><span class='text-success'> R : </span> &nbsp;{{line.personnel}}</b></div>
                {% else %}
                <div><span class="text-success">cliquez sur "<i class="fas fa-pen"></i>"</span></div>
                {% endif %}
                {% if line.accountable != None %} <div><b><span class='text-danger'> A : </span> &nbsp;{{line.accountable}}</b></div>{% endif %}
                {% if line.consulted != None %} <div><b><span class='text-primary'> C : </span> &nbsp;{{line.consulted}}</b></div>{% endif %}
                {% if line.informed != None %} <div><b><span style="color:orange;"> I : </span> &nbsp;{{line.informed}}</b></div>{% endif %}
                {% else %} <!--{% for r in line.raci_roles %}<div>{% for r2 in r.role_racis %}<small class="btn-info badge p-1" >{{r2}}</small> {% endfor %} <small><b>{{r.m_personnel}}</b></small></div> {% endfor %}--> <span class="btn btn-info" data-op="{{line}}" data-toggle="modal" data-target="#RACIModal" onclick="updateRACI(this)" data-racis="{% for r in line.raci_roles %} {% for r2 in r.role_racis %} {{r2}} - {% endfor %}#{{r.m_personnel}}| {% endfor %}">    Fiche RACI </span> {% endif %}</td>
                <td style="display:none;"></td>
                <td style="display:none;" {% if line.accountable != None %} data-id="{{line.accountable.id}}" {% endif %}>
                    <td style="display:none;" {% if line.consulted != None %} data-id="{{line.consulted.id}}" {% endif %}>
                        <td style="display:none;" {% if line.informed != None %}data-id="{{line.informed.id}}" {% endif %}>

                            <td style="display:none;"></td>
                            <td style="display:none;"></td><!--  Role Column -->
                            {% if actual_institution.default_options == True %}
                            {% if line.periodes != None %}
                            <td data-id="{{actual_institution.default_subperiod}}" data-desc="{{line.periodes.m_chronogramme.m_decoupage}}" data-period="{{line.periodes.m_desc_realisation}}"><div style="display:flex;justify-content: space-between;">{% for period in line.periodes.chrono_split %}<div style="padding:5px;" >{{period}}&nbsp;&nbsp;</div>{% endfor %}</div><div style="display:flex;justify-content: space-between;" class="">{% for period in line.periodes.desc_split %}<div style="font-weight:bold;">{% if period != '9' %}{% if period == '0' %}<i class="fas fa-clock"></i>{% elif period == '1' %}<i class="fas fa-check"></i>{% elif period == '2' %}<i class="fas fa-check text-success"></i>{% endif %}{% else %}<i style="opacity:0;'" class="fas fa-pen"></i>{% endif %}</div>{% endfor %}</div></td>
                            {% else %}
                            <td></td>
                            {% endif %}

                            {% else %}
                            {% if false_vr == False %}
                            {% if line.periodes != None %}

                            <td data-id="{{actual_institution.default_subperiod}}" data-desc="{{line.periodes.m_chronogramme.m_decoupage}}" data-is_period="1" data-period="{{line.periodes.m_desc_realisation}}"><div style="display:flex;justify-content: space-between;">{% for period in line.periodes.chrono_split %}<div style="padding:5px;" >{{period}}&nbsp;&nbsp;</div>{% endfor %}</div><div style="display:flex;justify-content: space-between;" class="">{% for period in line.periodes.desc_split %}  <div style="font-weight:bold;">{% if period != '9' %}{% if line.etat == '0' %}<i class="fas fa-clock"></i>{% elif line.etat == '1' %}<i class="fas fa-check"></i>{% elif line.etat == '2' %}<i class="fas fa-check text-success"></i>{% endif %}{% else %}<i style="opacity:0;'" class="fas fa-pen"></i>{% endif %}</div>{% endfor %}</div><div><small class="text-primary">{{line.periodes.actu_value}}</small></div></td>

                            {% else %}
                            <td></td>

                            {% endif %}
                            {% else %}
                            <td>
                                <div>
                                    {% for op_detail in line.get_operation_details %}
                                    <div class="py-1" style="border-bottom:1px solid #aaa;"><a class="{% if op_detail.etat == '2' %} text-success {% else %} text-danger {% endif %}" href="/operations/details/{{line.id}}"> <small><i class="fas fa-file"></i> {{op_detail}}</small> </a> </div>
                                    {% empty %}
                                    <div> Aucun Rapport pour le Moment</div>
                                    {% endfor %}
                                </div>
                            </td>
                            <!-- Operation Details -->
                            {% endif %}
                            <!-- Operation Details -->

                            {% endif %}

                            {% if actual_institution.default_options == False %}

                            <!-- {% for val in line.values_spl2 %}
                            <td class="t_cell value_liner text-primary">{{val}}</td>
                            {% endfor %} -->
                            {% else %}
                            <td data-id='{{line.priorite}}'>{{line.priorite}}</td>
                        </td>
                        <td class="t_cell"  >{{line.montant}} </td>
                        
                        <td class="t_cell">{% if line.rapported.date_creation == None %}<span style="cursor:pointer;" class="p-2  btn-rapport" data-id="{{line.id}}" data-tache="{{line}}" data-result="{{line.result_process}}" data-target="#addModal" data-toggle='modal'>Aucun Rapport</span>{% else %}<a href="{{line.rapported.piece_jointe.url}}" class=""> {% if line.rapported.nom_piece_jointe != None %} {{line.rapported.nom_piece_jointe}}{% else %} {{line.rapported.piece_jointe}} {% endif %}</a> {% if line.tech_rapports.first.commentaire != None %}<span data-toggle="modal" data-html="true" data-target='#commentOperModal' title="{{line.tech_rapports.first.commentaire}}" style="cursor:pointer;" class="badge bg-comment" data-comments="{{line.tech_rapports.first.commentaire}}" data-operation="{{line}}" data-personnel="{{line.personnel}}" data-tache="s">Voir Commentaires</span> {% endif %}{% endif %}</td>
                        {% endif %}
                        <!-- <td>
                           
                            {% comment %} <button class="btn btn-success" onclick="editBTN(this)" data-target="#addActionModal" data-id="{{line.id}}" data-toggle="modal">
                                <i class="fas fa-pencil-alt"></i> </button> {% endcomment %}
                                   <button class="btn btn-danger delete-btn"  onclick='merde(this);' data-target="#deleteModal" data-id="{{line.id}}" data-toggle="modal"><i class="fas fa-trash-alt"></i></button> 
                                   
                                   <a href="/clone_operations/{{line.id}}/" class="btn btn-info text-light" > <i class="fas fa-edit"></i> </button> 
                                    <a href="/duplicate_operation/{{line.id}}/" class="btn btn-success text-light"><i class="fas fa-clone"></i>   </a>
                        
                        </td>
                     
                      -->
                      <td>
                        <div class="dropdown">
                          <button type="button" class="btn p-0 dropdown-toggle hide-arrow" data-bs-toggle="dropdown" aria-expanded="false">
                            <i class="bx bx-dots-vertical-rounded"></i>
                          </button>
                          <div class="dropdown-menu" style="">

                            <!-- <button class=" dropdown-item  dup_btn" data-name="{{line}}" data-target="#dupliqModal" data-toggle='modal' data-id="{{line.id}}"><i class="bx bx-copy"></i>Dupliquer</button> -->
                            <button class=" dropdown-item"  data-bs-toggle="modal" data-bs-target="#exLargeModal{{line.id}}"><i class="bx bx-bookmarks"></i>H&eacute;ritage Operation </button>
                            <!-- <a class="dropdown-item" href="/duplicate_operation/{{line.id}}/"><i class="bx bx-copy"></i> Clone</a> -->
                            <a class="dropdown-item" href="/clone_operations/{{line.id}}/"><i class="bx bx-edit-alt me-1"></i> Edit</a>
                            <a class="dropdown-item" href="javascript:void(0);"  onclick='merde(this);' data-target="#deleteModal" data-id="{{line.id}}" data-toggle="modal"><i class="bx bx-trash me-1"></i> Delete</a>
                          </div>
                        </div>
                      </td>
                     
                     
                            <td class="t_cell">{{line.date_creation}}</td>
                    </tr>
                    <!--
                    <tr>
                        <td colspan="28" class="bg-info text-white" style="cursor:pointer;"> Afficher Liste </td>
                    </tr>
                    <tr style="display:none;" class="td-op_details" data-name="{{line.id}}">
                        
                    </tr> -->



                    <div class="modal fade" id="exLargeModal{{line.id}}" tabindex="-1" aria-hidden="true">
                        <div class="modal-dialog modal-xl" role="document">
                          <div class="modal-content">
                            <div class="modal-header">
                              <h5 class="modal-title" id="exampleModalLabel4" style="font-weight:bold">Creer Une Operation Qui H&eacute;rite De {{line.nom}}</h5>
                              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <div class="modal-body">
                              <div class="row">
                               
                                <form onsubmit="saveOperation(this)" class="form-horizontal bordered-row" action="/save_gestion/" id="addFormAction" data-toggle="validator" role="form" method="post" data-toggle="validator" enctype="multipart/form-data" >
                                    {% csrf_token %}
                                    <div class=" d-flex justify-content-center row">
                                        <div class="col-sm-12">
                                            <div class="form-group">
                                                Nom {{sub_entity}}
                                                <input type="text" class="form-control" name="nom" id="nomAct" required="">
                                            </div>
                                        </div>                             
                                    </div>
                                    {% if actual_institution.default_options != True %}
                                    <input type="hidden" name="operation_aggregates" id="operation_aggregates">
                                    {% for th in actual_institution.operations_modules.fill_fields %}
                                    <div class=" d-flex justify-content-center row">
                                        <div class="col-md-12 form-group">
                                            <label>{{th.field}}</label>
                                            {% if th.type == 'string' or th.type == 'text' or th.type == 'char' %}
                                            <input type="text" class="form-control agg1">
                                            {% elif th.type == 'int' or th.type == 'number'  %}
                                            <input type="number" class="form-control agg1">
                                            {% elif th.type == 'choix' %}
                                            <div><small>Les valeurs doivent &ecirc;tre s&eacute;par&eacute;es par des Sauts de Ligne</small></div>
                                            <textarea value="" class="form-control agg1"></textarea>
                                            {% elif th.type == 'file' or th.type == 'image'  %}
                                            <input type="file" name="{{th.field}}_nam" class="form-control agg1">
                                            {% else %}
                                            {% endif %}
                                        </div>
                                    </div>
                                    {% endfor %}
                                    {% endif %}
                                    <div  class=" d-flex justify-content-center row">
                                        <div class="col-md-12 form-group">
                                            <label> P&eacute;riode : {{base_val.m_type_entity}} </label>
                                            {% for s in searches %}
                                            <select id='modal_per_select' name="tache_periode" class="col-sm-8 form-control">
                                                {% for val in s.values %}
                                                <option value="{{val}}">{{val}}</option>
                                                {% endfor %}
                                            </select>
                                            {% endfor %}
                                        </div>
                                    </div>
                                    <input type="hidden" name="redirect" {% if detail_g_v == True %} value="{{base_val.id}}" {% else %} value="-1" {% endif %}>
        

                                    <div id="prinRESP" class=" justify-content-center row">
                                        <div class="col-md-12">
                                            <div class="assiDIV">
                                                <label class="text-success"><span class="badge badge-success">R</span>  Principal Responsable</label>
                                
                                            <select name="perso" class="responsable_selector form-control" id="responsable">
                                                {% for perso in personnels %}
                                                <option value="{{perso.id}}">{{perso.get_structure}} - {{perso}}</option>
                                                {% endfor %}
                                                <option value="0">Non D&eacute;fini</option>
                                            </select>
                                            <div class="d-none mt-1 form-group">
                                                <span data-launch='1' style="cursor:pointer;" class="assiLAUNCH text-success" >Assigner &agrave;  un R&ocirc;le</span>
                                            </div>
                                        </div>
                                    </div>
                                    <div style='display:none;' class="assiDIV form-group">
                                        R&ocirc;le
                                        <div class="">
                                            <select name="role" class="form-control">
                                                {% for role in roles %}
                                                <option value="{{role.id}}">{{role}}</option>
                                                {% endfor %}
                                            </select>
                                            <div class="mt-1 form-group">
                                                <span style="cursor:pointer;" data-launch='0' class="assiLAUNCH text-success">Assigner &acirc;  un Personnel</span>
                                            </div> 
                                        </div>  
                                    </div>
                                </div>
                           
        
                            {% if actual_institution.default_options == True %}
                            <div class=" d-flex justify-content-center row mb-3">
                                <div class="col-lg-8">
                                    <label>Ajouter des Pieces Jointes ? ( Optionnel )</label>
                                    <input class="form-control" type="file" name="file_oko">
                                </div>
                            </div>
                            {% endif %}
                          
                                
                                    <div class="col-sm-12">
                                        <div class="assiDIV ">
                                            <label class="text-danger"><span class="badge badge-danger">A</span> Accountable</label>
        
                                            <div class="justify-content-around">
                                                <select name="accountable" class="accounted_selector form-control">
                                                    <option value="0">Non D&eacute;fini</option>
                                                    {% for perso in personnels %}
                                                    <option value="{{perso.id}}">{{perso.get_structure}} - {{perso}}</option>
                                                    {% endfor %}
                                                </select>
                                                <div class="d-none mt-1 ">
                                                    <span data-launch='1' style="cursor:pointer;" class="assiLAUNCH text-success" >Assigner &agrave;  un R&ocirc;le</span>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="assiDIV ">
                                            <label class="text-warning"><span class="badge badge-warning">C</span>  Consulted</label>
        
                                            <div class="justify-content-around">
                                                <select name="consulted" class="consulted_selector form-control">
                                                    <option value="0">Non D&eacute;fini</option>
                                                    {% for perso in personnels %}
                                                    <option value="{{perso.id}}">{{perso.get_structure}} - {{perso}}</option>
                                                    {% endfor %}
                                                </select>
                                                <div class="d-none mt-1 ">
                                                    <span data-launch='1' style="cursor:pointer;" class="assiLAUNCH text-success" >Assigner &agrave;  un R&ocirc;le</span>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="assiDIV ">
                                            <label class="text-success"><span class="badge badge-info">I</span>Informed</label>
        
                                            <div class="justify-content-around">
                                                <select name="informed" class="informed_selector form-control">
                                                    <option value="0">Non D&eacute;fini</option>
                                                    {% for perso in personnels %}
                                                    <option value="{{perso.id}}">{{perso.get_structure}} - {{perso}}</option>
                                                    {% endfor %}
                                                </select>
                                                <div class="d-none mt-1 form-group">
                                                    <span data-launch='1' style="cursor:pointer;" class="assiLAUNCH text-success" >Assigner &agrave; un Ro&circ;le</span>
                                                </div>
                                            </div>
                                        </div>



                                        <div class="assiDIV ">
                                            <label class="text-success"><span class="badge badge-info">P</span>Participant</label>
        
                                            <div class="justify-content-around">
                                                <select name="participant" class="informed_selector form-control">
                                                    <option value="0">Non D&eacute;fini</option>
                                                    {% for perso in personnels %}
                                                    <option value="{{perso.id}}">{{perso.get_structure}} - {{perso}}</option>
                                                    {% endfor %}
                                                </select>
                                                <div class="d-none mt-1 form-group">
                                                    <span data-launch='1' style="cursor:pointer;" class="assiLAUNCH text-success" >Assigner &agrave; un Ro&circ;le</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                

                                
                                    <input type="text" name="operation_id" value="{{line.id}}" style="display:none">

                            <div class="d-flex justify-content-center row mb-3">
                                <div class="px-3 col-md-12">
                                    <label> D&eacute;coupage : Delai</label>
                                    <div>

                                        <select id='decoup_select' name="sub_period" class="form-control">
                                            {% for sub in base_val.plannification.m_periode.sub_periods %}
                                            {% if sub.id == actual_institution.default_subperiod.id %}
                                            <option class="plannif_selector" data-index="{{forloop.counter}}" value="{{sub.id}}">{{sub}}</option>
                                            {% endif %}
                                            {% endfor %}
                                        </select>

                                    </div>
                                </div>
                            </div>

                            {%if actual_institution.nature != False%}
                            <div  class="d-flex justify-content-center row mb-3">
                           
                                <div class="px-3 col-md-12">
                                 
                                       
                                     <label>   Nature De L'op&eacute;ration </label>
                                        <select name="nature" class="form-control">
                                            <option ></option>
                                            {%for natures in nature%}
                                            <option value="{{ natures.id }}">{{natures.intitule}}</option>
                                            {%endfor%}
                                        </select>
                                   
                                   
                                </div>
                            </div>
                            {%endif%}
                            {%if actual_institution.categorie_op != False%}
                           
                                <div class="d-flex justify-content-center row mb-3">
                                    <div class="px-3 col-md-12">
                                     
                                   <label>     Categorie De L'op&eacute;ration</label>
                                        <select name="categorie" class="form-control">
                                            <option ></option>
                                            {%for categorie_operations in categorie_operation%}
                                            <option value="{{ categorie_operations.id }}">{{categorie_operations.intitule}}</option>
                                            {%endfor%}
                                        </select>
                                   
                              
                                </div>
                            </div>
                            {%endif%}

                           

                           
                     <div class="col-md-12">
                            {% for sub_periode in base_val.plannification.m_periode.sub_periods %}
                            {% if actual_institution.default_subperiod == sub_periode %}
                            <div id='period_decoup{{sub_periode.id}}' class="period_decoups row justify-content-around col-12">
                                {% for label in sub_periode.decoup_desc_slip %}
                                <div class="custom-control custom-checkbox">
                                    <input type="checkbox" class=" acheck checkbox custom-control-input clock_sem"  id="calend{{label}}"    />
                                    <label class="custom-control-label"  for="calend{{label}}">{{label}}</label>
                                    <div><small class="modal_calco_date text-primary"></small></div>
                                </div>
                                {% endfor %}
                            </div>
                            {% endif %}
                            {% endfor %}
                        </div>
                            <input type="hidden" id="chronogr" name="chronogr">
                            <div class="my-2 d-flex flex-wrap justify-content-center">
                                <div class="col-6 col-sm-4">
                                    <div class="form-group">
                                        Priorit&eacute;
                                        <select name="priorite" class="form-control">
                                            <option value="Basse">Basse</option>
                                            <option value="Normale" selected="">Normale</option>
                                            <option value="Haute">Haute</option>
                                        </select>
                                       
                                        
                                    </div>
                                </div>
                              


                                <div class="col-6 col-sm-4">
                                    <div class="form-group">
                                        Montant
                                        <input type="number" class="form-control" name="montant" value=0 id="nomAct"> <br>
                                        Mode de Notification
                                        <select name="notification" class="form-control">
                                            <option value="2">SMS & Email</option>
                                            <option value="1">Adresse Mail</option>
                                            <option value="1">SMS</option>
                                        </select>
                                    </div>
                                  
                                         
                                </div> 
				  <div class="col-6 col-sm-4">
                   
                        <div class="form-group">
                            Date Debut
                            <input type="date" name="date_debut" id="date_debut" class="form-control" value="{{line.date_echeance|date:'Y-m-d'}}">
                        </div>
                 
                                    <div class="form-group">
                                        Date Echeance
                                        <input type="date" class="form-control" name="date_echeance" >
                                    
                                       
                                    </div>
                                </div>
                     
                            
                              
                          
                                <div class="container-fluid">
                                 
                                    <div class="accordion" id="accordionExample">
                                        <div class="card accordion-item active">
                                          <h2 class="accordion-header" id="headingOne">
                                            <button type="button" class="accordion-button btn btn-danger" data-bs-toggle="collapse" data-bs-target="#accordionOne" aria-expanded="true" aria-controls="accordionOne" role="tabpanel">
                                             D&eacute;finir Les Periodes Et La Structure
                                            </button>
                                          </h2>
                                      
                                          <div id="accordionOne" class="accordion-collapse collapse show" data-bs-parent="#accordionExample">
                                            <div class="accordion-body">
                                                Structure
                                                    <select class="form-control" name="structure" id="structure" >  
                                                        <option></option>  
                                                        {% for structures in structure %}  
                                                            <option value="{{ structures.id }}">{{ structures.nom }}</option>  
                                                        {% endfor %}  
                                                    </select>  
                                                    
                                                    Année
                                                    <select class="form-control" name="annee" id="annee" >  
                                                        <option></option>  
                                                        {% for periode in period %}  
                                                            <option value="{{ periode.annee }}">{{ periode.annee }}</option>  
                                                        {% endfor %}  
                                                    </select>  
                                                    Mois
                                                    <select class="form-control" name="mois" id="period" >  
                                                        <option></option>  
                                                    </select>  
                                            </div>
                                          </div>
                                        </div>
                                        <div class="card accordion-item">
                                          <h2 class="accordion-header" id="headingTwo">
                                            <button type="button" class="accordion-button collapsed btn btn-danger" data-bs-toggle="collapse" data-bs-target="#accordionTwo" aria-expanded="false" aria-controls="accordionTwo" role="tabpanel">
                                              Selectionnez Les Formulaires
                                            </button>
                                          </h2>
                                          <div id="accordionTwo" class="accordion-collapse collapse" aria-labelledby="headingTwo" data-bs-parent="#accordionExample">
                                            <div class="accordion-body">
                                                {%if actual_institution.formulaire != False%}
                                                <div class="col-md-12">
                                                  
                                                       
                                                 
                                                        {%for datasets in dataset%}
                                                        <label>  
                                                            <input type="checkbox" name="dataset[]" value="{{ datasets.id }}"  class="toggle-public" id="check">   
                                                            <div class="btn btn-sık"><span>{{datasets.m_name}}</span></div>  
                                                        </label>
                                                        {%endfor%}
                                                  
                                                </div>
                                                {%endif%}
                                            </div>
                                          </div>
                                        </div>
                                       
                                      </div>
                            
                                    
    
                                  
                                      </div>
                                   
                                          
                           
                            
                                </div>
                            <input type="hidden" name="edit_or_create" id="edit_or_create" value="c">
                            <input type="hidden" name="edit_id" id="edit_id">
                            <input type='hidden' name='generator' value='o'>
                            <input type="hidden" name="tache" value='{{base_val.id}}'>
                            <input type="hidden" name="who_assign" id='who_assign' value=0>

                                    
                                    



                              </div>
                            </div>
                            <div class="modal-footer">
                              <button type="button" class="btn btn-label-secondary" data-bs-dismiss="modal">Fermer</button>
                              <button type="submit" class="btn btn-primary">Enregistrer</button>
                            </div>
                        </form>
                          </div>
                        </div>
                      </div>
                    {% endfor %} 
                    {% endblock %}
                </tbody>
            </table>


            {% endblock %}

            {% block add_modal %}
            <div class="modal fade" id="RACIModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                <div class="modal-dialog ">
                    <div class="modal-content">
                        <div class="modal-header">
                            <!--button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button-->
                            <h4 class="modal-title" >Repartition RACI <span class="h4 text-primary" id="RACI_operation"></span>  </h4>
                            <button type="button" class="close waves-effect waves-light" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">x</span>
                            </button>
                        </div>

                        <div class="modal-body">
                            <div><small> Repartition des R&ocirc;les</small></div>
                            <div id="RACI_details_div">


                            </div>
                        </div>
                    </div>
                </div>
            </div>



        <!-- <div class="modal fade bd-example-modal-xl" id="addActionModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
            <div style='max-width:1400px;' class="modal-dialog modal-lg">
                <div class="modal-content">
                    <div class="modal-header">
                      
                        <h4 class="modal-title text-primary"  id="modify_title" style="font-weight:bold">Ajouter {{actual_institution.operations_name}} </h4>
                        <button type="button" class="close waves-effect waves-light" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">x</span>
                        </button>

                    </div>
		<p style="font-weight:bold" class="text-primary mx-2">	 {{base_val}} </p> -->
        <!-- <div class="modal fade" id="addActionModal" tabindex="-1" aria-hidden="true">
            <div class="modal-dialog modal-fullscreen" role="document">
              <div class="modal-content">
                <div class="modal-header">
                  <h5 class="modal-title" id="modalFullTitle">Ajouter {{actual_institution.operations_name}}</h5>
                  <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div> -->
                <div class="modal fade" id="addActionModal" tabindex="-1" aria-hidden="true">
                    <div class="modal-dialog modal-xl" role="document">
                      <div class="modal-content">
                        <div class="modal-header">
                          <h5 class="modal-title" id="exampleModalLabel4">Ajouter {{actual_institution.operations_name}}</h5>
                          <button type="button" class="close waves-effect waves-light" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">x</span>
                        </button>
                          <!-- <button type="button" class="btn-close close" data-bs-dismiss="modal" aria-label="Close"></button> -->
                        </div>
                    <div class="modal-body">
                        <form onsubmit="saveOperation(this)" class="form-horizontal bordered-row" action="/save_gestion/" id="addFormAction" data-toggle="validator" role="form" method="post" data-toggle="validator" enctype="multipart/form-data" >
                            {% csrf_token %}
                            <div class=" d-flex justify-content-center row">
                                <div class="col-sm-8">
                                    <div class="form-group">
                                        Nom {{sub_entity}}
                                        <input type="text" class="form-control" name="nom" id="nomAct" required="">
                                    </div>
                                </div>                             
                            </div>
                            {% if actual_institution.default_options != True %}
                            <input type="hidden" name="operation_aggregates" id="operation_aggregates">
                            {% for th in actual_institution.operations_modules.fill_fields %}
                            <div class=" d-flex justify-content-center row">
                                <div class="col-sm-8 form-group">
                                    <label>{{th.field}}</label>
                                    {% if th.type == 'string' or th.type == 'text' or th.type == 'char' %}
                                    <input type="text" class="form-control agg1">
                                    {% elif th.type == 'int' or th.type == 'number'  %}
                                    <input type="number" class="form-control agg1">
                                    {% elif th.type == 'choix' %}
                                    <div><small>Les valeurs doivent &ecirc;tre s&eacute;par&eacute;es par des Sauts de Ligne</small></div>
                                    <textarea value="" class="form-control agg1"></textarea>
                                    {% elif th.type == 'file' or th.type == 'image'  %}
                                    <input type="file" name="{{th.field}}_nam" class="form-control agg1">
                                    {% else %}
                                    {% endif %}
                                </div>
                            </div>
                            {% endfor %}
                            {% endif %}
                            <div  class=" d-flex justify-content-center row">
                                <div class="col-sm-8 form-group">
                                    <label> P&eacute;riode : {{base_val.m_type_entity}} </label>
                                    {% for s in searches %}
                                    <select id='modal_per_select' name="tache_periode" class="col-sm-8 form-control">
                                        {% for val in s.values %}
                                        <option value="{{val}}">{{val}}</option>
                                        {% endfor %}
                                    </select>
                                    {% endfor %}
                                </div>
                            </div>
                            <input type="hidden" name="redirect" {% if detail_g_v == True %} value="{{base_val.id}}" {% else %} value="-1" {% endif %}>
                            
                         
                    </center>

                    <div class=" d-none justify-content-center row mb-3" id="shit_hidden">
                        <input type="hidden" name="RACI_hidden" id="RACI_hidden">
                        <input type="hidden" name="RACI_hidden_roles" id="RACI_hidden_roles">
                        <div class="col-lg-12">
                            <center><div><input type="checkbox" id="showRACI" value="1" name="showRACI" onclick="displayRACI()"><label for="showRACI">D&eacute;coupage RACI</label></div></center>
                            <center>
                                <div style="display:none;" id="RACI_DIV">
                                    <div class="d-flex justify-content-center flex-wrap my-2">
                                        <div class="text-success"><small style="cursor:pointer;" onclick="addRaciLine()">+ Ajouter une Ligne</small> </div>
                                        <div class="p-4"></div>
                                        <div class="text-danger"><small style="cursor:pointer;" onclick="removeRaciLine()">- Enlever une Ligne</small> </div>
                                    </div>

                                    <table id="table_RACI" class="table table-responsive" style="max-height:300px;overflow: auto;">
                                        <thead>
                                            <td> Utilisateur </td>
                                            {% for rol in actual_institution.structures_split %}
                                            <td class="text-info"> {{rol}} </td>
                                            {% endfor %}
                                        </thead>
                                        <tbody id='table_RACI_lines'>
                                            <tr>
                                                <td>
                                                            <!-- <input type="text" for="persos_li" class="form-control" name="">
                                                            <datalist id="persos_li">   
                                                                {% for perso in personnels %}
                                                                <option value="{{perso.id}}">{{perso}}</option>
                                                                {% endfor %}
                                                            </datalist> -->
                                                            <select class="form-control">
                                                                {% for perso in personnels %}
                                                                <option value="{{perso.id}}">{{perso}}</option>
                                                                {% endfor %}
                                                            </select>
                                                        </td>
                                                        {% for rol in actual_institution.structures_split %}
                                                        <td>
                                                            <input type="checkbox"  name="">
                                                        </td>
                                                        {% endfor %}
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </center>
                                </div>
                            </div>
                           
                         

                            <div class="d-flex justify-content-center row mb-3">
                                <div class="px-3 col-6 col-md-8">
                                    <label> D&eacute;coupage : Delai</label>
                                    <div>

                                        <select id='decoup_select' name="sub_period" class="form-control">
                                            {% for sub in base_val.plannification.m_periode.sub_periods %}
                                            {% if sub.id == actual_institution.default_subperiod.id %}
                                            <option class="plannif_selector" data-index="{{forloop.counter}}" value="{{sub.id}}">{{sub}}</option>
                                            {% endif %}
                                            {% endfor %}
                                        </select>

                                    </div>
                                </div>
                            </div>
                            <div class="container-fluid">
                                <div class="accordion accordion-header-primary" id="accordionStyle3">
                                    <div class="accordion-item">
                                      <h2 class="accordion-header text-light">
                                        <button
                                          type="button"
                                          class="accordion-button collapsed bg-primary text-light" style="font-weight: bold;"
                                          data-bs-toggle="collapse"
                                          data-bs-target="#accordionStyle1-1"
                                          aria-expanded="false">
                                        Gestion des Responsabilit&eacute;s
                                        </button>
                                      </h2>
                                  
                                      <div id="accordionStyle1-1" class="accordion-collapse collapse" data-bs-parent="#accordionStyle3">
                                        <div class="accordion-body">
                                        
                                            
                                                <div class="assiDIV form-group">
                                                    <label class="text-success"><span class="badge badge-success">R: Principal Responsable</span>  </label>
                                    
                                                <select name="perso" class="responsable_selector form-control" id="responsable">
                                                    <option value="0">Non D&eacute;fini</option>
                                                    {% for perso in personnels %}
                                                    <option value="{{perso.id}}">-{{perso}}</option>
                                                    {% endfor %}
                                                 
                                                </select>
                                                <div class="d-none mt-1 form-group">
                                                    <span data-launch='1' style="cursor:pointer;" class="assiLAUNCH text-success" >Assigner &agrave;  un R&ocirc;le</span>
                                                </div>
                                            </div>
                                        
    
                                        <div class="assiDIV form-group">
                                            <label class="text-danger"><span class="badge badge-danger">A: Accountable</span> </label>
        
                                            <div class="justify-content-around">
                                                <select name="accountable" class="accounted_selector form-control">
                                                    <option value="0">Non D&eacute;fini</option>
                                                    {% for perso in personnels %}
                                                    <option value="{{perso.id}}"> - {{perso}}</option>
                                                    {% endfor %}
                                                </select>
                                                <div class="d-none mt-1 form-group">
                                                    <span data-launch='1' style="cursor:pointer;" class="assiLAUNCH text-success" >Assigner &agrave;  un R&ocirc;le</span>
                                                </div>
                                            </div>
                                        </div>
    
    
                                        <div class="assiDIV form-group">
                                            <label class="text-warning"><span class="badge badge-warning">C: Consulted</span>  </label>
        
                                            <div class="justify-content-around">
                                                <select name="consulted" class="consulted_selector form-control">
                                                    <option value="0">Non D&eacute;fini</option>
                                                    {% for perso in personnels %}
                                                    <option value="{{perso.id}}">- {{perso}}</option>
                                                    {% endfor %}
                                                </select>
                                                <div class="d-none mt-1 form-group">
                                                    <span data-launch='1' style="cursor:pointer;" class="assiLAUNCH text-success" >Assigner &agrave;  un R&ocirc;le</span>
                                                </div>
                                            </div>
                                        </div>
    
    
                                        <div class="assiDIV form-group">
                                            <label class="text-success"><span class="badge badge-info">I: Informed</span></label>
        
                                            <div class="justify-content-around">
                                                <select name="informed" class="informed_selector form-control">
                                                    <option value="0">Non D&eacute;fini</option>
                                                    {% for perso in personnels %}
                                                    <option value="{{perso.id}}">- {{perso}}</option>
                                                    {% endfor %}
                                                </select>
                                                <div class="d-none mt-1 form-group">
                                                    <span data-launch='1' style="cursor:pointer;" class="assiLAUNCH text-success" >Assigner &agrave; un Ro&circ;le</span>
                                                </div>
                                            </div>
    
    
    
    
                                        </div>
    
                                        <div class="assiDIV ">
                                            <label class="text-dark"><span class="badge badge-info">Manager</span></label>
        
                                            <div class="justify-content-around">
                                                <select name="participant" class="informed_selector form-control">
                                                    <option value="0">Non D&eacute;fini</option>
                                                    {% for perso in personnels %}
                                                    <option value="{{perso.id}}">- {{perso}}</option>
                                                    {% endfor %}
                                                </select>
                                                <div class="d-none mt-1 form-group">
                                                    <span data-launch='1' style="cursor:pointer;" class="assiLAUNCH text-success" >Assigner &agrave; un Ro&circ;le</span>
                                                </div>
                                            </div>
                                        </div>
                                      </div>
                                    </div>
                                  
                                   
                                  
                                  </div>
    
    
    
                                <div id="prinRESP" class=" justify-content-center row">
                                   
                                <div style='display:none;' class="assiDIV form-group">
                                    R&ocirc;le
                                    <div class="">
                                        <select name="role" class="form-control">
                                            {% for role in roles %}
                                            <option value="{{role.id}}">{{role}}</option>
                                            {% endfor %}
                                        </select>
                                        <div class="mt-1 form-group">
                                            <span style="cursor:pointer;" data-launch='0' class="assiLAUNCH text-success">Assigner &acirc;  un Personnel</span>
                                        </div> 
                                    </div>  
                                </div>
                            </div>
                       
    
                        {% if actual_institution.default_options == True %}
                        <div class=" d-flex justify-content-center row mb-3">
                            <div class="col-lg-8">
                                <label>Ajouter des Pieces Jointes ? ( Optionnel )</label>
                                <input class="form-control" type="file" name="file_oko">
                            </div>
                        </div>
                        {% endif %}
                        <center>
                            <div class="">  
                                <div class="col-sm-8">
                                   
                                   
                                  
                                    </div>
    
                                   
                                </div>
                            </div>
                            </div>
                           

                         
                           
                     
                            {% for sub_periode in base_val.plannification.m_periode.sub_periods %}
                            {% if actual_institution.default_subperiod == sub_periode %}
                            <div id='period_decoup{{sub_periode.id}}' class="period_decoups row justify-content-around col-12">
                                {% for label in sub_periode.decoup_desc_slip %}
                                <div class="custom-control custom-checkbox">
                                    <input type="checkbox" class=" acheck checkbox custom-control-input clock_sem"  id="calend{{label}}"    />
                                    <label class="custom-control-label"  for="calend{{label}}">{{label}}</label>
                                    <div><small class="modal_calco_date text-primary"></small></div>
                                </div>
                                {% endfor %}
                            </div>
                            {% endif %}
                            {% endfor %}

                            <input type="hidden" id="chronogr" name="chronogr">
                            
                          
                            
                                   
                                          
                           
                            <div class="container-fluid">

                                <div class="accordion accordion-header-primary my-4" id="accordionStyle">
                                    <div class="accordion-item">
                                      <h2 class="accordion-header">
                                        <button
                                          type="button"
                                          class="accordion-button collapsed bg-dark text-light" stype="font-weight: bold;"
                                          data-bs-toggle="collapse"
                                          data-bs-target="#accordionStyle1-1"
                                          aria-expanded="false">
                                          Informations Supplementaires
                                        </button>
                                      </h2>
                                  
                                      <div id="accordionStyle1-1" class="accordion-collapse collapse" data-bs-parent="#accordionStyle">
                                        <div class="accordion-body">
                                            {%if actual_institution.nature != False%}
                                            
                                                 
                                                       
                                                     <label>   Nature De L'op&eacute;ration </label>
                                                        <select name="nature" class="form-control">
                                                            <option ></option>
                                                            {%for natures in nature%}
                                                            <option value="{{ natures.id }}">{{natures.intitule}}</option>
                                                            {%endfor%}
                                                        </select>
                                                   
                                               
                                            {%endif%}
                                            {%if actual_institution.categorie_op != False%}
                                           
                                               
                                                     
                                                   <label>     Categorie De L'op&eacute;ration</label>
                                                        <select name="categorie" class="form-control">
                                                            <option ></option>
                                                            {%for categorie_operations in categorie_operation%}
                                                            <option value="{{ categorie_operations.id }}">{{categorie_operations.intitule}}</option>
                                                            {%endfor%}
                                                        </select>
                                                   
                                              
                                             
                                            {%endif%}


                                       
                                        
                                          
                                                Priorit&eacute;
                                                <select name="priorite" class="form-control">
                                                    <option value="Basse">Basse</option>
                                                    <option value="Normale" selected="">Normale</option>
                                                    <option value="Haute">Haute</option>
                                                </select>
                                               
                                                
                                            
                                       
                                      
        
        
                                        
                                           
                                                Montant
                                                <input type="number" class="form-control" name="montant" value=0 id="nomAct"> <br>
                                                Mode de Notification
                                                <select name="notification" class="form-control">
                                                    <option value="2">SMS & Email</option>
                                                    <option value="1">Adresse Mail</option>
                                                    <option value="1">SMS</option>
                                                </select>
                                           
                                          
                                                 
                                    
                                      
                                        
                                              
                                                    Date Debut
                                                    <input type="date" name="date_debut" id="date_debut" class="form-control">
                                             
                                          
                                                Date Echeance
                                                <input type="date" class="form-control" name="date_echeance" >
                                            
                                               
                                        
                                      </div>
                                    </div>
                                  
                                    
                                  
                                 
                                  </div>






                                 
                                <div class="accordion my-4" id="accordionExample2">
                                  
                                    <div class="card accordion-item">
                                      <h2 class="accordion-header" id="headingTwo" style="font-weight: bold;">
                                        <button type="button" class="accordion-button collapsed bg-danger text-light" data-bs-toggle="collapse" data-bs-target="#accordionTwo" aria-expanded="false" aria-controls="accordionTwo" role="tabpanel">
                                         Informations Sur Les Formuaires De Saisi
                                        </button>
                                      </h2>
                                      <div id="accordionTwo" class="accordion-collapse collapse" aria-labelledby="headingTwo" data-bs-parent="#accordionExample2">
                                        <div class="accordion-body">
                                            {%if actual_institution.formulaire != False%}
                                            <div class="col-md-12">
                                              
                                                   
                                             
                                                    {%for datasets in dataset%}
                                                    <label>  
                                                        <input type="checkbox" name="dataset[]" value="{{ datasets.id }}"  class="toggle-public" id="check">   
                                                        <div class="btn btn-sık"><span>{{datasets.m_name}}</span></div>  
                                                    </label>
                                                    {%endfor%}
                                              
                                            </div>
                                            {%endif%}
                                            Structure 
                                            <select class="form-control" name="structure" id="structure" >  
                                                <option></option>  
                                                {% for structures in structure %}  
                                                    <option value="{{ structures.id }}">{{ structures.nom }}</option>  
                                                {% endfor %}  
                                            </select>  
                                            
                                            Année
                                            <select class="form-control" name="annee" id="annee_c" >  
                                                <option></option>  
                                                {% for periode in period %}  
                                                    <option value="{{ periode.annee }}">{{ periode.annee }}</option>  
                                                {% endfor %}  
                                            </select>  
                                            Mois
                                            <select class="form-control" name="mois" id="period_c" >  
                                                <option></option>  
                                            </select> 
                                        </div>
                                      </div>
                                    </div>
                                   
                                  </div>
                        
                                

                              
                                  </div>
                                </div>
                            <input type="hidden" name="edit_or_create" id="edit_or_create" value="c">
                            <input type="hidden" name="edit_id" id="edit_id">
                            <input type='hidden' name='generator' value='o'>
                            <input type="hidden" name="tache" value='{{base_val.id}}'>
                            <input type="hidden" name="who_assign" id='who_assign' value=0>

                                          
                      
                   
                   
                    <div class="modal-footer">
                        <button type="button" class="btn btn-label-secondary" data-dismiss="modal">Fermer</button>
                        <button type="submit" class="btn btn-primary">Enregistrer</button>  
                             
                    </div>
                    
               
         
        </form>
        </div>
    </div>
</div>
</div>
</div>

</div>

        {% endblock %}


        {% block script_operation %}
        <script>
            $(document).ready(function() {
                $('#annee').on('change', function() {
                    var selectedId = $(this).val();
                    
                    $.ajax({
                        url: '/search_period_id/',  // L'URL correspondant à la vue Django
                        method: 'GET',
                        data: { annee: selectedId },
                        success: function(data) {
                            var selectInformations = $('#period');
                            selectInformations.empty(); // Effacer les anciennes options
                            
                            // Ajouter les nouvelles options basées sur les données récupérées via AJAX
                            data.forEach(function(period_id) {
                                selectInformations.append($('<option>', {
                                    value: period_id.id,
                                    text: period_id.nom  // Remplacez 'champ1' par le nom du champ que vous souhaitez afficher
                                }));
                            });
                        },
                        error: function(xhr, status, error) {
                            console.error('Une erreur s\'est produite lors de la requête AJAX :', status, error);
                        }
                    });
                });
            });
            </script>
            <script>
                $(document).ready(function() {
                    $('#annee_c').on('change', function() {
                        var selectedId = $(this).val();
                        
                        $.ajax({
                            url: '/search_period_id/',  // L'URL correspondant à la vue Django
                            method: 'GET',
                            data: { annee: selectedId },
                            success: function(data) {
                                var selectInformations = $('#period_c');
                                selectInformations.empty(); // Effacer les anciennes options
                                
                                // Ajouter les nouvelles options basées sur les données récupérées via AJAX
                                data.forEach(function(period_id) {
                                    selectInformations.append($('<option>', {
                                        value: period_id.id,
                                        text: period_id.nom  // Remplacez 'champ1' par le nom du champ que vous souhaitez afficher
                                    }));
                                });
                            },
                            error: function(xhr, status, error) {
                                console.error('Une erreur s\'est produite lors de la requête AJAX :', status, error);
                            }
                        });
                    });
                });
                </script>
      <script src="https://cdn.jsdelivr.net/npm/tom-select@2.3.1/dist/js/tom-select.complete.min.js"></script>
        <script>

            new TomSelect('#ex-caret-position',{
                plugins: ['caret_position','input_autogrow'],
            });
        </script>
        <script>
            $.ajax({
                url: '/ajax_RACI_user/manage/',
                data: {
                    'menu':'o',
                    'entity':{{base_val.id}},
                },
                dataType: 'json',
                success:function(data){
                    responsable_selector = document.getElementsByClassName("responsable_selector");
                    accounted_selector = document.getElementsByClassName("accounted_selector");
                    consulted_selector = document.getElementsByClassName("consulted_selector");
                    informed_selector = document.getElementsByClassName("informed_selector");
                    for (var i=0;i<responsable_selector.length;i++){
                        if (data.responsable != "")responsable_selector[i].value = data.responsable;
                        if (data.accounted != "") accounted_selector[i].value = data.accounted;
                        if (data.consulted != "") consulted_selector[i].value = data.consulted;
                        if (data.informed != "") informed_selector[i].value = data.informed;    
                    }                   
                },
                error:function(){
                    alert("EACI Error")
                }

            });
        </script>
        <script type="text/javascript">
            assiLAUNCH = document.getElementsByClassName("assiLAUNCH");
            assiDIV = document.getElementsByClassName("assiDIV");
            for (var i=0;i<assiLAUNCH.length;i++){
                assiLAUNCH[i].onclick = function(){
                    index = this.getAttribute('data-launch');
                    $(assiDIV[parseInt(1-index)]).hide('slow',function(){
                        $(assiDIV[parseInt(index)]).show('slow');
                    });
                }
            }
        </script>
        <script type="text/javascript">
            var period_decoups = document.getElementsByClassName("period_decoups");
            for (var i=1; i<period_decoups.length; i++){
                period_decoups[i].style.display = "none";
            }
            var decoup_select = document.getElementById("decoup_select");
    //var plannif_selector = document.getElementsByClassName("plannif_selector");
    select_value = parseInt(decoup_select.value);
    //alert(select_value)
    decoup_select.onchange = function(){
        select_value = (parseInt(this.value));
        $(".period_decoups").hide('slow',function(){
            $("#period_decoup"+select_value).show('slow');
        });
        clock_sem = document.getElementsByClassName("clock_sem");
        clock_sem[0].checked = true;
    }
    clock_sem = document.getElementsByClassName("clock_sem");
    clock_sem[0].checked = true;
    agg1 = document.getElementsByClassName("agg1");
    agg1_length = (agg1.length);
    //alert(agg1_length)

    $("#addFormAction").submit(function(){
        //alert("Ok")
        {% if actual_institution.default_options != True %}
        operation_aggregates = document.getElementById("operation_aggregates");
        agg1 = document.getElementsByClassName("agg1");
        RACI_hidden = document.getElementById("RACI_hidden")
        tmp = ""
        for (var i=0;i<agg1_length;i++){
            tmp += agg1[i].value + "|";
        }
        operation_aggregates.value = tmp;
        {% endif %}

        chronogr = document.getElementById("chronogr");
        subperiod_id = decoup_select.value;
        checkbox = document.getElementById("period_decoup"+select_value).getElementsByClassName("clock_sem");       
        for (var i=0; i<checkbox.length; i++){
            if (checkbox[i].checked == true){
                chronogr.value += "0" + "_"
            }
            else{
                chronogr.value += "9" + "_"
            }
        }

        RACI_options = document.getElementById("table_RACI_lines").getElementsByTagName("input");
        RACI_roles = document.getElementById("table_RACI_lines").getElementsByTagName("select");
        tmp_RACI_2 = ""
        for (var i=0; i<RACI_roles.length;i++){
            tmp_RACI_2 += RACI_roles[i].value+"#";
        }
        RACI_hidden_roles = document.getElementById("RACI_hidden_roles")
        RACI_hidden_roles.value = tmp_RACI_2;
        tmp_RACI = ""
        for (var i=0; i<RACI_options.length;i++){
            if (i%4==0 && i>0){
                tmp_RACI +="#"
            }
            if (RACI_options[i].checked == true){
                tmp_RACI += "1"
            }
            else{
                tmp_RACI += "0"
            }
            tmp_RACI += "|";
        }
        RACI_hidden.value = tmp_RACI;

        console.log(RACI_hidden.value)
        console.log(operation_aggregates.value)
    });


    $(".acheck[type='checkbox']").on('change',function(){
        $(".acheck[type='checkbox']").not(this).prop('checked',false);
    });
</script>
<script type="text/javascript">
    var barColors = ["green","orange"];
    structures = ["EffectuÃ©es","Non EffectuÃ©es"];
    yValues= [{{base_val.operations_done_count}},{{base_val.operations_not_done_count}}];
    new Chart("myChartSub", {
        type: "doughnut",
        data: {
            labels: structures,
            datasets: [{
                backgroundColor: barColors,
                data: yValues
            }]
        },
        options: {
            title: {
                display: true,
                text: "Evolution des OpÃ©rations",
                beginAtZero: true
            }
        }
    }); 

    function addRaciLine(){
        table_RACI_lines = document.getElementById("table_RACI_lines");
        trs = table_RACI_lines.getElementsByTagName("tr");
        table_RACI_lines.innerHTML += trs[0].innerHTML;
    }

    function removeRaciLine(){
        table_RACI_lines = document.getElementById("table_RACI_lines");
        trs = table_RACI_lines.getElementsByTagName("tr");
        table_RACI_lines.innerHTML = "";
        if (trs.length > 0){
            for (var i=0; i<trs.length; i++){
                table_RACI_lines.innerHTML += trs[0].innerHTML
            }
        }
    }

    var dpR = 0;
    function displayRACI(){
        if (dpR == 1){
            $("#RACI_DIV").hide('slow');
            $("#prinRESP").show('slow');
        }
        else{
            $("#RACI_DIV").show('slow');
            $("#prinRESP").hide("slow");
        }
        dpR = 1 - dpR;
    }

    modal_per_select = document.getElementById("modal_per_select");

    function ajCD(text,divs="#"){
        {% if actual_institution.default_period.m_logic_type == 3 %}
        $.ajax({
            url: '/ajax_calcul_date/',
            data: {
                'plannify':text,
                'periode':{{actual_institution.default_period.id}}
            },
            dataType: 'json',
            success:function(data){
                if (divs == "#"){
                    period_decoups = document.getElementsByClassName("period_decoups")[0]
                    modal_calco_date = document.getElementsByClassName("modal_calco_date");
                        //period_decoups.innerHTML = ""
                        for (var j=0; j<data.test_dates.length; j++){
                            modal_calco_date[j].innerHTML = data.test_dates[j]; 
                        }
                    }
                },
                error:function(){
                }
            });
        {% endif %}     
    }
    ajCD(modal_per_select.getElementsByTagName("option")[0].value)
    modal_per_select.onchange = function(){
        ajCD(this.value);
    }

    function updateRACI(elt){
        RACI_operation = document.getElementById("RACI_operation");
        RACI_details_div = document.getElementById("RACI_details_div");
        RACI_operation.textContent = elt.getAttribute("data-op");
        data_racis = elt.getAttribute("data-racis").split("|");
        topm = "";
        for (var j=0;j<data_racis.length;j++){
            az = data_racis[j].split("#")
            topm += "<tr>"
            for (var k=0; k<az.length; k++){
                topm += "<td> "+az[k]+"</td>"
            }
            topm += "</tr>"
        }
        topm = "<table class='table'><thead><tr><td> RÃ´le </td><td> Personnel </td></tr></thead><tbody>"+topm+"</tbody></table>";
        RACI_details_div.innerHTML = topm;
    }

    function saveOperation(elt){
        //alert(elt)
        who_assign = document.getElementById("who_assign");
        if (dpR == 1){
            who_assign.value = "2";
        }
    }

    function showRACI_dup(elt){
        raci_block_dup = document.getElementById("raci_block_dup")
        if (elt.checked == true){
            $("#raci_block_dup").show("slow")
        }
        else{
            $("#raci_block_dup").hide("slow")
        }
    }

    rename_dup = document.getElementById("rename_dup")
    rename_dup.onchange = function(){
        data_show = this.getAttribute('data-show');
        show = 1 - parseInt(data_show);
        this.setAttribute('data-show',show);
        this.setAttribute('value',show);

        rename_div = document.getElementById("rename_div");
        if (show  == 1){
            $(rename_div).show('slow')
        }
        else{
            $(rename_div).hide('slow')
        }
    }


</script>


<script type="text/javascript">
    // custom.js
    
    $(document).ready(function() {
      $('#responsable').on('change', function() {
        var selectedId = $(this).val();
    
        // Effectuer une requête AJAX pour récupérer les informations de la table periodeok en fonction de l'ID de la période sélectionnée
        $.ajax({
          url: '/search_numbers/',  // L'URL correspondant à la vue Django
          method: 'GET',
          data: { id: selectedId },
          success: function(data) {
            var selectInformations = $('#number_1');
            selectInformations.empty(); // Effacer les anciennes options
    
            // Ajouter les nouvelles options basées sur les données récupérées via AJAX
            data.forEach(function(ind) {
              selectInformations.append($('<option>', {
                value: ind.id,
                text: ind.tel,  // Remplacez 'champ1' par le nom du champ que vous souhaitez afficher

              }));
              
            });
          },
          error: function(xhr, status, error) {
            console.error('Une erreur s\'est produite lors de la requête AJAX :', status, error);
          }
        });
      });
    });
    
    </script>





{% for message in messages %}
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
 {% if message.tags == 'success' %}

<script type="text/javascript">
 Swal.fire({
 position: "top-end",
 icon: "success",
 title: "{{message}}",
 showConfirmButton: false,
 timer: 2000
});
</script>
{%endif%}
{%endfor%}
</script>
{% for message in messages %}
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
 {% if message.tags == 'error' %}

<script type="text/javascript">
 Swal.fire({
 position: "top-end",
 icon: "error",
 title: "{{message}}",
 showConfirmButton: false,
 timer: 5000
});
</script>
{%endif%}
{%endfor%}


{% for message in messages %}
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
 {% if message.tags == 'info' %}

<script type="text/javascript">
 Swal.fire({
 position: "top-end",
 icon: "info",
 title: "{{message}}",
 showConfirmButton: false,
 timer: 9000
});
</script>
{%endif%}
{%endfor%}
<script>
    $(function () {
        $("#check").click(function () {
            if ($(this).is(":checked")) {
                $("#structure").show();
              
            } else {
                $("#structure").hide();
               
            }
        });
    });
</script>
{% endblock %}
