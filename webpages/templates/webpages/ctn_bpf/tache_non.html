
<style>
  .flexcard {

    width: 95%;

    height: 400px;
    border-radius: 20px;
    margin:8px;
  }

  .flexcardNumber {
    width: 70%;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 50px;
    margin: 10px 0px;
    border-radius: 0px 50px 50px 0px;
    font-family: 'Jost', sans-serif;
    color: white;
    text-shadow: 0px 3px 5px black;
    font-weight: 500;
    font-size: 15px;
    position: relative;
  }

  .flexcardTitle {
    font-family: 'Jost', sans-serif;
    text-transform: uppercase;
    font-size: 26px;
    font-weight: 400;
  }

  .flexcardText {
    font-family: 'Jost', sans-serif;
    text-align: center;
    font-weight: 300;
  }

  .flexcardNumber:before {
    content: '';
    width: 34px;
    height: 90px;
    position: absolute;
    left: -33px;
    top: 0px;
    border-radius: 50px 0px 0px 50px;
    z-index: -1;
  /* background: #95B7A2; *//* background: -webkit-linear-gradient(bottom, #95B7A2, #AED2BC); */
    background: -moz-linear-gradient(bottom, #95B7A2, #AED2BC);
  /* background: linear-gradient(to top, #95B7A2, #AED2BC); */;
  }

  .flexcardNumber:after {
    content: '';
    width: 25px;
    height: 40px;
    position: absolute;
    left: -25px;
    bottom: -40px;
    border-radius: 50px 0px 0px 50px;
    z-index: -1;
  }

  .flex {
    display: flex;
    justify-content: center;
    width: 100%;
    margin: 10px auto;
  }

  img.flexcardimgItem {
    width: 50%;
  }

  /* GREEN CARD */

  .flexcardGreen {
    background: #f9fbfa;
    box-shadow: 4px 4px 4px #AED2BC;
  }

  .flexcardNumberGreen {
    background: #FCFCFC;
    background: -webkit-linear-gradient(right, #FCFCFC, #AED2BC);
    background: -moz-linear-gradient(right, #FCFCFC, #AED2BC);
    background: linear-gradient(to left, #FCFCFC, #AED2BC);
    box-shadow: 0px 2px 2px #AED2BC;
  }

  .flexcardNumberGreen:before {
    background: #AED2BC;
  }

  .flexcardNumberGreen:after {
    background: #95b7a2;
  }


  /*flex card red*/
  .flexcardNumberred {
    background: #dc3545;
    background: #dc3545;
    background: #dc3545;
    background: #dc3545;
    box-shadow: 0px 2px 2px #dc3545;
  }

  .flexcardNumberred:before {
    background: #dc3545;
  }

  .flexcardNumberred:after {
    background: #dc3545;
  }

  /* BLUE CARD */

  .flexcardBlue {
    background: #f7ffff;
   box-shadow: 4px 8px 1px #92E8EB;
  }

  .flexcardNumberBlue {
    background: #FDFFFE;
    background: -webkit-linear-gradient(right, #FDFFFE, #92E8EB);
    background: -moz-linear-gradient(right, #FDFFFE, #92E8EB);
    background: linear-gradient(to left, #FDFFFE, #92E8EB);
    box-shadow: 0px 2px 2px #92E8EB;
  }

  .flexcardNumberBlue:before {
    background: #92E8EB;
  }

  .flexcardNumberBlue:after {
    background: #71bdbf;
  }

  /* ORANGE CARD */

  .flexcardOrange {
    background: #fdf8f3;
   box-shadow: 4px -2px 1px #F68404;
  }

  .flexcardNumberOrange {
    background: #FDFFFE;
    background: -webkit-linear-gradient(right, #FDFFFE, #F68404);
    background: -moz-linear-gradient(right, #FDFFFE, #F68404);
    background: linear-gradient(to left, #FDFFFE, #F68404);
    box-shadow: 0px 2px 2px #F68404;
  }

  .flexcardNumberOrange:before {
    background: #F68404;
  }

  .flexcardNumberOrange:after {
    background: #d06f02;
  }

  /* PİNK CARD */

  .flexcardPink {
    background: #fffafd;
    position: relative;
      box-shadow: 2px 2px 1px #F34EAE ;
      border-radius: 20px 20px 0px 20px;
  }
  .flexcardPink:before {
      content: '';
      width: 0px;
      height: 50px;
      /* background: red; */
      position: absolute;
      bottom: 0;
      right: 0;
      border-left: 100px solid transparent;
      border-bottom: 90px solid #F34EAE;
  }
  .flexcardNumberPink {
    background: #FDFFFE;
    background: -webkit-linear-gradient(right, #FDFFFE, #F34EAE);
    background: -moz-linear-gradient(right, #FDFFFE, #F34EAE);
    background: linear-gradient(to left, #FDFFFE, #F34EAE);
    box-shadow: 0px 2px 2px #F34EAE;
  }

  .flexcardNumberPink:before {
    background: #F34EAE;
  }

  .flexcardNumberPink:after {
    background: #d24095;
  }

  /* RESPONSİVE */

/*  @media only screen and (max-width: 800px) {

    .flexcard {
      width: 35%;
      margin-top: 20px;
    }

    img.flexcardimgItem {
      width: 30%;
    }

  }*/

/*  @media only screen and (max-width: 500px) {

    .flexcard {
      width: 70%;
    }


  }*/
  footer {
      display: flex;
      width: 100%;
      justify-content: center;
      margin: 50px;
      font-family: 'Jost', sans-serif;
      font-size: 15px;
  }
/* Style pour la pagination arrondie et centrée */
.pagination {
  display: flex;
  justify-content: center;
}

.pagination .page-item {
  margin: 0 5px;
  border-radius: 20px; /* Pour obtenir des coins arrondis */
}

.pagination .page-link {
  color: #fff; /* Couleur du texte */
  background-color: #007bff; /* Couleur de fond */
  border-color: #007bff; /* Couleur de la bordure */
}

.pagination .page-link:hover {
  background-color: #0056b3; /* Couleur de fond au survol */
  border-color: #0056b3; /* Couleur de la bordure au survol */
}

</style>
{% extends './operations_details.html' %}
{% load humanize %}
{% load static %}
{% block miniBigLeft %}
<div class="mb-3">
	<div style="width: 100%;" class="d-flex justify-content-between border-bottom border-primary mb-2">
		<a class="btn text-primary" href="/">Tableau de Bord</a>
		<div><i class="fas text-primary fa-angle-down"></i></div>
	</div>
</div>
{%endblock%}
{% block add_title %}

Liste Des Op&eacute;rations Non realis&eacutes;es
{% endblock %}

{% block content %}
<div class="container-fluid">
  <div class="row">
    <div class="col-md-12">
      <div class="accordion" id="accordionExample">
        <div class="accordion-item">
          <h2 class="accordion-header" id="headingOne">
            <button class="accordion-button btn btn-primary" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
            
            </button>
          </h2>
          <div id="collapseOne" class="accordion-collapse collapse show" aria-labelledby="headingOne" data-bs-parent="#accordionExample">
            <div class="accordion-body">
              <strong> Op&eacute;rations Globales   non R&eacute;alis&eacute;es</strong> 
            </div>
          </div>
        </div>
        <div class="accordion-item">
          <h2 class="accordion-header" id="headingTwo">
            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">
              Options De Recherche
            </button>
          </h2>
          <div id="collapseTwo" class="accordion-collapse collapse" aria-labelledby="headingTwo" data-bs-parent="#accordionExample">
            <div class="accordion-body">
              <!-- <strong>This is the second item's accordion body.</strong> It is hidden by default, until the collapse plugin adds the appropriate classes that we use to style each element. These classes control the overall appearance, as well as the showing and hiding via CSS transitions. You can modify any of this with custom CSS or overriding our default variables. It's also worth noting that just about any HTML can go within the <code>.accordion-body</code>, though the transition does limit overflow. -->
              <div class="row">
                <div class="col-md-4">
                <label style="font-weight:bold">Nom Operation</label>
                <input type="search" class="form-control p-2 my-2" id="search" placeholder="recherchez Vos Operations planifiees">
                </div>
                <div class="col-md-4">
                  <label style="font-weight:bold">Priorit&eacute; Op&eacute;ration</label>
                  <select class="form-control my-2">
                    <option>Normale</option>
                    <option>Haute</option>
                    <option>Basse</option>
                  </select>
                  </div>
                <div class="col-md-4">
                <label style="font-weight:bold">Responsable Realisation</label>
                <select class="form-control my-2" id="filter_personnel">
                  <option>Selectionnez Le Responsible</option>
                  {%for personnels in personnel%}
                  <option>{{personnels.nom}}</option>
                  {%endfor%}
                  </select>
                </div>
                </div>
            </div>
          </div>
        </div>
        
      </div>
    </div>
  </div>
</div>
<div class="container">
  
<div class="row">
  <div class="col-lg-4 ">
    <h5 style="font-weight:bold; font-family:quartz;">Priorit&eacute;es Haute</h5><br/>
    {% for operations in operation %}
      {% if operations.priorite == "Haute" %}
        <div>
              <div class="flexcard flexcardGreen {%if operations.delai_restant == 'Le délai est écoulé !'%} bg-danger text-light{%else%} bg-light text-dark{%endif%}">

      <div class="flexcardNumber  {%if operations.delai_restant == 'Le délai est écoulé !'%}flexcardNumberred text-light {%else%}flexcardNumberGreen{%endif%} " style="font-style: italic;"> &eacute;ch&eacute;ance {{operations.date_echeance}}
                Responsible:{{operations.personnel.nom}}
       </div>
<span class="badge badge-primary"> ID Op&eacute;ration: {{operations.id}}</span>

      <div class="flex flexcardTitle">
<img src="{% if operations.personnel.photo == '47774_frHGCVr.png' and operations.personnel.sexe == 'M' %}
            {% static 'webpages/ctn_bpf/M.png' %}
          {% elif operations.personnel.photo == '47774_frHGCVr.png' and operations.personnel.sexe == 'F' %}
            {% static 'webpages/ctn_bpf/F.jpg' %}
          {% elif operations.personnel.photo != '47774_frHGCVr.png' %}
            {{ operations.personnel.photo.url }}
          {% elif operations.personnel.photo == '47774_frHGCVr.png' and not operations.personnel.sexe %}
            {% static 'webpages/ctn_bpf/icons8-sad-64.png' %}
          {% endif %}"
     alt="avatar" class="flexcardimgItem rounded-circle">
      </div>
      <div class="flex flexcardText">{{operations.nom}} </div>
      <div class="flex flexcardImg">

        <button class="btn btn mx-2 {%if operations.delai_restant == 'Le délai est écoulé !'%} text-light btn btn-danger{%else%} btn btn-primary text-light{%endif%}" data-bs-toggle="modal" data-bs-target="#staticBackdrop1{{ operations.id }}"> Historique(s)</button>
        <button class="btn btn {%if operations.delai_restant == 'Le délai est écoulé !'%}btn btn-danger text-light{%else%} btn btn-primary text-light{%endif%}" data-bs-toggle="modal" data-bs-target="#staticBackdrop11{{ operations.id }}">Commentaire(s)</button>
  </div>
</div>
        </div>
      {% endif %}
      <div class="modal fade" id="staticBackdrop1{{ operations.id }}" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialogmodal-lg">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="exampleModalLabel">Historique De L'op&eacute;ration: <b class="text-primary">{{operations.nom}}</b></h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <table class="table table-center  mb-0  table-responsive w-100 table-responsive">
                                        <thead class="text-center ">
                                          <tr>
                                            <th style="width:25%"><h6>R: Responsible</h6></th>
                                            <th style="width:25%"><h6>A: Accountable</h6></th>
                                            <th style="width:25%"><h6>C: Consulted</h6></th>
                                            <th style="width:25%"><h6>I: Informed</h6></th>

                                          </tr>
                                        </thead>
                                        <tbody class="text-center">
                                          <tr>
                                            <td><div class="d-flex align-items-center">
                                                <img
                                                    src="{{ operations.personnel.photo.url }}"
                                                    alt=""
                                                    style="width: 45px; height: 45px"
                                                    class="rounded-circle"
                                                    />
                                                    &nbsp;&nbsp;
                                                <div class="ms-3">
                                                  <p class="fw-bold mb-1">{{operations.personnel.nom}}</p>

                                                </div>
                                              </div></td>
                                            <td>
                                              <div class="d-flex align-items-center">
                                                <img
                                                    src="{{ operations.accountable.photo.url }}"
                                                    alt=""
                                                    style="width: 45px; height: 45px"
                                                    class="rounded-circle"
                                                    />
                                                    &nbsp;&nbsp;
                                                <div class="ms-3">
                                                  <p class="fw-bold mb-1">{{operations.accountable.nom}}</p>

                                                </div>
                                              </div>
                                            </td>
                                            <td>
                                               <div class="d-flex align-items-center">
                                                <img
                                                    src="{{ operations.consulted.photo.url }}"
                                                    alt=""
                                                    style="width: 45px; height: 45px"
                                                    class="rounded-circle"
                                                    />
                                                    &nbsp;&nbsp;
                                                <div class="ms-3">
                                                  <p class="fw-bold mb-1">{{operations.consulted.nom}}</p>

                                                </div>
                                              </div>
                                            </td>
                                            <td>
                                              <div class="d-flex align-items-center">
                                                <img
                                                    src="{{ operations.informed.photo.url }}"
                                                    alt=""
                                                    style="width: 45px; height: 45px"
                                                    class="rounded-circle"
                                                    />
                                                    &nbsp;&nbsp;
                                                <div class="ms-3">
                                                  <p class="fw-bold mb-1">{{operations.informed.nom}}</p>

                                                </div>
                                              </div>
                                            </td>
                                          </tr>
                                        </tbody>
                                      </table>
                                    <hr/>
              <table class="table  mb-0 bg-white table-responsive w-100">
                <thead class="bg-light">
                  <tr>
                    <th style="width:25%">Op&eacute;ration Attribu&eacute; &agrave; :</th>
                    <th style="width:25%">Date Affectation</th>
                    <th style="width:25%">Priorit&eacute</th>
                    <th style="width:25%">Ech&eacute;nce</th>

                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td>
                      <div class="d-flex align-items-center">
                        <img
                            src="{{ operations.personnel.photo.url }}"
                            alt=""
                            style="width: 45px; height: 45px"
                            class="rounded-circle"
                            />
                            &nbsp;&nbsp;
                        <div class="ms-3">
                          <p class="fw-bold mb-1">{{operations.personnel.nom}}</p>
                          <p class="text-muted mb-0">{{operations.personnel.mail}}</p>
                        </div>
                      </div>
                    </td>
                    <td>
                      <p class="fw-normal mb-1">{{operations.date_creation}}</p>
                      <p class="text-muted mb-0"> ({{operations.date_creation|naturaltime}})</p>
                    </td>
                    <td>
                      <span class="badge badge-success rounded-pill d-inline">{{operations.priorite}}</span>
                    </td>
                    <td>{{operations.date_echeance}}</td>

                  </tr>


                </tbody>
              </table>
              <hr/>
              <table  class="table align-middle mb-0 bg-white table-responsive">
                <thead class="bg-light">
                  <tr>
                    <th style="width:25%">Commentaire(s) Faite(s) Par:</th>
                    <th style="width:25%">Commentaire</th>
                    <th style="width:25%">Date Commentaire</th>
                    {%if operation_historics.file|length == '0'%}
                   {%else%}
                   <th>Fichier Joint</th>
                    {%endif%}
                  </tr>
                </thead>
                <tbody>
              {%for operation_historics in operation_historic%}
              {%if operation_historics.m_operation_id == operations.id%}
                  <tr>
                    <td>
                      <div class="d-flex align-items-center">
                        <img
                            src="{{operation_historics.personnel.photo.url}}"
                            alt=""
                            style="width: 45px; height: 45px"
                            class="rounded-circle"
                            />
                        <div class="ms-3">

                            <p class="text-muted fw-bold mb-1" style="font-family:quartz">{{operation_historics.m_role}}</p>
                          <p class="text-muted mb-0" style="font-family:quartz">{{operation_historics.personnel.mail}}</p>

                        </div>
                      </div>
                    </td>
                    <td>
                     <p class="fw-normal mb-1"></p>
                      <p class="text-muted mb-0">{{operation_historics.m_commentaire}}</p>
                    </td>
                    <td>
                      <span class="d-inline">{{ operation_historics.m_date_realisation }}</span>

                     ({{ operation_historics.m_date_realisation|naturaltime }})
                    </td>

                  <td>
			<a href="/download_files/{{operation_historics.id}}"> {{operation_historics.file}}</a>
		</td>
                     </tr>
              {%endif%}

              {%endfor%}

                </tbody>
              </table>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-danger" data-dismiss="modal">Fermer</button>

            </div>
          </div>
        </div>
      </div>
      <div class="modal fade" id="staticBackdrop0{{ operations.id }}" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="exampleModalLabel">Faites Un Commentaire Pour L'op&eacute;ration: <b class="text-primary">{{operations.nom}}</b></h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
      
      <!-- <div class="modal fade" id="staticBackdrop0{{ operations.id }}" data-backdrop="static" data-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-lg">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="staticBackdropLabel">{{ request.user.personnel.nom }} Faites Un Commentaire Pour L'op&eacute;ration: <b class="text-primary">{{operations.nom}}</b></h5>
              <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
              </button>
            </div> -->
            <div class="modal-body">
           <form method="POST" action="/save_comment/" enctype="multipart/form-data">
                                            {%csrf_token%}
                                        <div class="modal-body">
                                            <label class="text-danger">Votre Commentaire *</label>
                                            <textarea class="form-control"name="commentaire"></textarea>
                                             <label class="text-primary">Attachez Un fichier</label>
                                            <input type="file" class="form-control" name="file">

                                              <label class="text-danger">Destinataire *</label>
                                            <input type="hidden" value='{{ operations.id }}' class="form-control" name="operation_id">

                                           <input type="text" class="form-control" name="role" value="{{ operations.personnel.nom }}" style="display: none">
                                                  <select class="form-control" name="email">
                                                    <option> Selectionnez Le destinataire</option>
                                                      {%for personnels in personnel%}
                                                    <option value="{{personnels.mail}}">{{personnels.mail}}<b class="text-danger" style="font-style: italic;">|{{personnels.nom}}</b></option>
                                                    {%endfor%}
                                                  </select>



                                        </div>
                                        <div class="modal-footer">
                                          <button type="button" class="btn btn-secondary" data-dismiss="modal">Fermer</button>
                                          <button type="submit" class="btn btn-primary">Soumettre</button>
                                        </div>
                                    </form>
                                  </div>
          </div>
        </div>
      </div>
    {% endfor %}
  </div>

  <div class="col-md-4 ">
    <h5 style="font-weight:bold; font-family:quartz" class="text-center">Priorit&eacute;es Normale</h5><br/>
    {% for operations in operation %}
      {% if operations.priorite == "Normale" %}
        <div>
          <div>

             <div class="flexcard flexcardGreen {%if operations.delai_restant == 'Le délai est écoulé !'%} bg-danger text-light{%else%} bg-light text-dark{%endif%}">

      <div class="flexcardNumber  {%if operations.delai_restant == 'Le délai est écoulé !'%}flexcardNumberred text-light {%else%}flexcardNumberGreen{%endif%} " style="font-style: italic;"> &eacute;ch&eacute;ance {{operations.date_echeance}}
     Responsible:{{operations.personnel.nom}}
      </div>
      <span class="badge badge-danger"> ID Op&eacute;ration: {{operations.id}}</span>
      <div class="flex flexcardTitle">
<img src="{% if operations.personnel.photo == '47774_frHGCVr.png' and operations.personnel.sexe == 'M' %}
            {% static 'webpages/ctn_bpf/M.png' %}
          {% elif operations.personnel.photo == '47774_frHGCVr.png' and operations.personnel.sexe == 'F' %}
            {% static 'webpages/ctn_bpf/F.jpg' %}
          {% elif operations.personnel.photo != '47774_frHGCVr.png' %}
            {{ operations.personnel.photo.url }}
          {% elif operations.personnel.photo == '47774_frHGCVr.png' and not operations.personnel.sexe %}
            {% static 'webpages/ctn_bpf/icons8-sad-64.png' %}
          {% endif %}"
     alt="avatar" class="flexcardimgItem rounded-circle">
      </div>
      <div class="flex flexcardText">{{operations.nom}} </div>
      <div class="flex flexcardImg">

        <button class="btn btn mx-2 {%if operations.delai_restant == 'Le délai est écoulé !'%} text-light btn btn-danger{%else%} btn btn-primary text-light{%endif%}" data-toggle="modal" data-target="#staticBackdrop1{{ operations.id }}"> Historique(s)</button>
        <button class="btn btn {%if operations.delai_restant == 'Le délai est écoulé !'%}btn btn-danger text-light{%else%} btn btn-primary text-light{%endif%}" data-toggle="modal" data-target="#staticBackdrop11{{ operations.id }}">Commentaire(s)</button>
  </div>
</div>
          </div>
        </div>
      {% endif %}
      <div class="modal fade" id="staticBackdrop1{{ operations.id }}" data-backdrop="static" data-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-lg">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="staticBackdropLabel">Historique De L'op&eacute;ration: <b class="text-primary">{{operations.nom}}</b></h5>
              <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
              </button>
            </div>
            <div class="modal-body">
              <table class="table table-center  mb-0 bg-white table-responsive w-100 table-responsive">
                                        <thead class="text-center bg-info text-light">
                                          <tr>
                                            <th style="width:75%"><h6>R: Responsible</h6></th>
                                            <th style="width:25%"><h6>A: Accountable</h6></th>
                                            <th style="width:25%"><h6>C: Consulted</h6></th>
                                            <th style="width:75%"><h6>I: Informed</h6></th>

                                          </tr>
                                        </thead>
                                        <tbody class="text-center">
                                          <tr>
                                            <td><div class="d-flex align-items-center">
                                                <img
                                                    src="{{ operations.personnel.photo.url }}"
                                                    alt=""
                                                    style="width: 45px; height: 45px"
                                                    class="rounded-circle"
                                                    />
                                                    &nbsp;&nbsp;
                                                <div class="ms-3">
                                                  <p class="fw-bold mb-1">{{operations.personnel.nom}}</p>

                                                </div>
                                              </div></td>
                                            <td>
                                              <div class="d-flex align-items-center">
                                                <img
                                                    src="{{ operations.accountable.photo.url }}"
                                                    alt=""
                                                    style="width: 45px; height: 45px"
                                                    class="rounded-circle"
                                                    />
                                                    &nbsp;&nbsp;
                                                <div class="ms-3">
                                                  <p class="fw-bold mb-1">{{operations.consulted.nom}}</p>

                                                </div>
                                              </div>
                                            </td>
                                            <td>
                                               <div class="d-flex align-items-center">
                                                <img
                                                    src="{{ operations.consulted.photo.url }}"
                                                    alt=""
                                                    style="width: 45px; height: 45px"
                                                    class="rounded-circle"
                                                    />
                                                    &nbsp;&nbsp;
                                                <div class="ms-3">
                                                  <p class="fw-bold mb-1">{{operations.consulted.nom}}</p>

                                                </div>
                                              </div>
                                            </td>
                                            <td>
                                              <div class="d-flex align-items-center">
                                                <img
                                                    src="{{ operations.informed.photo.url }}"
                                                    alt=""
                                                    style="width: 45px; height: 45px"
                                                    class="rounded-circle"
                                                    />
                                                    &nbsp;&nbsp;
                                                <div class="ms-3">
                                                  <p class="fw-bold mb-1">{{operations.informed.nom}}</p>

                                                </div>
                                              </div>
                                            </td>
                                          </tr>
                                        </tbody>
                                      </table>
                                    <hr/>
              <table class="table align-middle mb-0 bg-white table-responsive">
                <thead class="bg-light">
                  <tr>
                    <th>Op&eacute;ration Attribu&eacute; &agrave; :</th>
                    <th>Date Affectation</th>
                    <th>Priorit&eacute</th>
                    <th>Ech&eacute;nce</th>

                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td>
                      <div class="d-flex align-items-center">
                        <img
                            src="{{ operations.personnel.photo.url }}"
                            alt=""
                            style="width: 45px; height: 45px"
                            class="rounded-circle"
                            />
                            &nbsp;&nbsp;
                        <div class="ms-3">
                          <p class="fw-bold mb-1">{{operations.personnel.nom}}</p>
                          <p class="text-muted mb-0">{{operations.personnel.mail}}</p>
                        </div>
                      </div>
                    </td>
                    <td>
                      <p class="fw-normal mb-1">{{operations.date_creation}}</p>
                      <p class="text-muted mb-0"> ({{operations.date_creation|naturaltime}})</p>
                    </td>
                    <td>
                      <span class="badge badge-success rounded-pill d-inline">{{operations.priorite}}</span>
                    </td>
                    <td>{{operations.date_echeance}}</td>

                  </tr>


                </tbody>
              </table>
              <hr/>
              <table  class="table align-middle mb-0 bg-white table-responsive">
                <thead class="bg-light">
                  <tr>
                    <th>Commentaire(s) Faite(s) Par:</th>
                    <th>Commentaire</th>
                    <th>Date Commentaire</th>
                    {%if operation_historics.file|length == '0'%}
                   {%else%}
                   <th>Fichier Joint</th>
                    {%endif%}
                  </tr>
                </thead>
                <tbody>
              {%for operation_historics in operation_historic%}
              {%if operation_historics.m_operation_id == operations.id%}
                  <tr>
                    <td>
                      <div class="d-flex align-items-center">
                        <img
                            src="{{operation_historics.personnel.photo.url}}"
                            alt=""
                            style="width: 45px; height: 45px"
                            class="rounded-circle"
                            />
                        <div class="ms-3">

                            <p class="text-muted fw-bold mb-1" style="font-family:quartz">{{operation_historics.m_role}}</p>
                          <p class="text-muted mb-0" style="font-family:quartz">{{operation_historics.personnel.mail}}</p>

                        </div>
                      </div>
                    </td>
                    <td>
                     <p class="fw-normal mb-1"></p>
                      <p class="text-muted mb-0">{{operation_historics.m_commentaire}}</p>
                    </td>
                    <td>
                      <span class="d-inline">{{ operation_historics.m_date_realisation }}</span>

                     ({{ operation_historics.m_date_realisation|naturaltime }})
                    </td>

                  <td>
<a href="/download_files/{{operation_historics.id}}"> {{operation_historics.file}}</a>
</td>
                     </tr>
              {%endif%}
              {%endfor%}

                </tbody>
              </table>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-danger" data-dismiss="modal">Fermer</button>

            </div>
          </div>
        </div>
      </div>
      <div class="modal fade" id="staticBackdrop11{{ operations.id }}" data-backdrop="static" data-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-lg">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="staticBackdropLabel">{{ request.user.personnel.nom }} Faites Un Commentaire Pour L'op&eacute;ration: <b class="text-primary">{{operations.nom}}</b></h5>
              <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
              </button>
            </div>
            <div class="modal-body">
         <form method="POST" action="/save_comment/" enctype="multipart/form-data">
                                            {%csrf_token%}
                                        <div class="modal-body">
                                            <label class="text-danger">Votre Commentaire *</label>
                                            <textarea class="form-control"name="commentaire"></textarea>
                                             <label class="text-primary">Attachez Un fichier</label>
                                            <input type="file" class="form-control" name="file">

                                              <label class="text-danger">Destinataire *</label>
                                            <input type="hidden" value='{{ operations.id }}' class="form-control" name="operation_id">

                                           <input type="text" class="form-control" name="role" value="{{ operations.personnel.nom }}" style="display: none">
                                                  <select class="form-control" name="email">
                                                    <option> Selectionnez Le destinataire</option>
                                                      {%for personnels in personnel%}
                                                    <option value="{{personnels.mail}}">{{personnels.mail}}<b class="text-danger" style="font-style: italic;">|{{personnels.nom}}</b></option>
                                                    {%endfor%}
                                                  </select>



                                        </div>
                                        <div class="modal-footer">
                                          <button type="button" class="btn btn-secondary" data-dismiss="modal">Fermer</button>
                                          <button type="submit" class="btn btn-primary">Soumettre</button>
                                        </div>
                                    </form>
                                  </div>
          </div>
        </div>
      </div>
    {% endfor %}
  </div>



  <div class="col-md-4 d-flex flex-column col-sm-12 col-ls-12">
    <h5 style="font-weight:bold; font-family:quartz" class="text-center">Priorit&eacute;es Basse</h5><br/>
    {% for operations in operation %}
      {% if operations.priorite == "Basse" %}
        <div>
          <div>
               <div class="flexcard flexcardGreen {%if operations.delai_restant == 'Le délai est écoulé !'%} bg-danger text-light{%else%} bg-light text-dark{%endif%}">

      <div class="flexcardNumber  {%if operations.delai_restant == 'Le délai est écoulé !'%}flexcardNumberred text-light {%else%}flexcardNumberGreen{%endif%} " style="font-style: italic;"> &eacute;ch&eacute;ance {{operations.date_echeance}}
        Responsible:{{operations.personnel.nom}}
      </div>
      <span class="badge badge-warning"> ID Op&eacute;ration: {{operations.id}}</span>
      <div class="flex flexcardTitle">
<img src="{% if operations.personnel.photo == '47774_frHGCVr.png' and operations.personnel.sexe == 'M' %}
            {% static 'webpages/ctn_bpf/M.png' %}
          {% elif operations.personnel.photo == '47774_frHGCVr.png' and operations.personnel.sexe == 'F' %}
            {% static 'webpages/ctn_bpf/F.jpg' %}
          {% elif operations.personnel.photo != '47774_frHGCVr.png' %}
            {{ operations.personnel.photo.url }}
          {% elif operations.personnel.photo == '47774_frHGCVr.png' and not operations.personnel.sexe %}
            {% static 'webpages/ctn_bpf/icons8-sad-64.png' %}
          {% endif %}"
     alt="avatar" class="flexcardimgItem rounded-circle">
      </div>
      <div class="flex flexcardText">{{operations.nom}} </div>
      <div class="flex flexcardImg">

        <button class="btn btn mx-2 {%if operations.delai_restant == 'Le délai est écoulé !'%} text-light btn btn-danger{%else%} btn btn-primary text-light{%endif%}" data-toggle="modal" data-target="#staticBackdrop1{{ operations.id }}"> Historique(s)</button>
        <button class="btn btn {%if operations.delai_restant == 'Le délai est écoulé !'%}btn btn-danger text-light{%else%} btn btn-primary text-light{%endif%}" data-toggle="modal" data-target="#staticBackdrop11{{ operations.id }}">Commentaire(s)</button>
  </div>
</div>
            <!-- <div class="card">
              <div class="img">
                <img src="{{operations.institution.img.url  }}" class="rounded">
                {{ actual_institution }}
              </div>
              <div class="infos">
                <div class="name">
                  <h2 style="background: #B7DEED;
background: linear-gradient(to right, #B7DEED 0%, #71CEEF 25%, #21B4E2 75%, #B7DEED 100%);
-webkit-background-clip: text;
-webkit-text-fill-color: transparent;

">{{operations.nom}}</h2>

                </div>
                           <p class="text" style="

background: #111DBF;
background: linear-gradient(to right, #111DBF 8%, #00FF00 75%, #23538A 67%);
-webkit-background-clip: text;
-webkit-text-fill-color: transparent;

overflow: hidden;
text-overflow: ellipsis;
white-space: nowrap;
">
                op&eacute;ration Cr&eacute;e
              {{ operations.date_creation|naturaltime }}
              </p>

                  <div class="links p-2 d-flex" style="margin-top:5px">
                  <button class="btn btn text-light" style="background-color: #D9AFD9;
background-image: linear-gradient(0deg, #D9AFD9 0%, #97D9E1 100%);
"  data-toggle="modal" data-target="#staticBackdrop2{{ operations.id }}">Historique</button>&nbsp;
                  <button class="btn btn-light"  data-toggle="modal" data-target="#staticBackdrop21{{ operations.id }}">Commentaire</button>
                </div>
              </div>
            </div> -->
          </div>
        </div>
      {% endif %}
      <div class="modal fade" id="staticBackdrop2{{ operations.id }}" data-backdrop="static" data-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-lg">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="staticBackdropLabel">Historique De L'op&eacute;ration: <b class="text-primary">{{operations.nom}}</b></h5>
              <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
              </button>
            </div>
            <div class="modal-body">
              <table class="table table-center  mb-0 bg-white table-responsive w-100 table-responsive">
                                        <thead class="text-center bg-info text-light">
                                          <tr>
                                            <th style="width:75%"><h6>R: Responsible</h6></th>
                                            <th style="width:25%"><h6>A: Accountable</h6></th>
                                            <th style="width:25%"><h6>C: Consulted</h6></th>
                                            <th style="width:75%"><h6>I: Informed</h6></th>

                                          </tr>
                                        </thead>
                                        <tbody class="text-center">
                                          <tr>
                                            <td><div class="d-flex align-items-center">
                                                <img
                                                    src="{{ operations.personnel.photo.url }}"
                                                    alt=""
                                                    style="width: 45px; height: 45px"
                                                    class="rounded-circle"
                                                    />
                                                    &nbsp;&nbsp;
                                                <div class="ms-3">
                                                  <p class="fw-bold mb-1">{{operations.personnel.nom}}</p>

                                                </div>
                                              </div></td>
                                            <td>
                                              <div class="d-flex align-items-center">
                                                <img
                                                    src="{{ operations.accountable.photo.url }}"
                                                    alt=""
                                                    style="width: 45px; height: 45px"
                                                    class="rounded-circle"
                                                    />
                                                    &nbsp;&nbsp;
                                                <div class="ms-3">
                                                  <p class="fw-bold mb-1">{{operations.consulted.nom}}</p>

                                                </div>
                                              </div>
                                            </td>
                                            <td>
                                               <div class="d-flex align-items-center">
                                                <img
                                                    src="{{ operations.consulted.photo.url }}"
                                                    alt=""
                                                    style="width: 45px; height: 45px"
                                                    class="rounded-circle"
                                                    />
                                                    &nbsp;&nbsp;
                                                <div class="ms-3">
                                                  <p class="fw-bold mb-1">{{operations.consulted.nom}}</p>

                                                </div>
                                              </div>
                                            </td>
                                            <td>
                                              <div class="d-flex align-items-center">
                                                <img
                                                    src="{{ operations.informed.photo.url }}"
                                                    alt=""
                                                    style="width: 45px; height: 45px"
                                                    class="rounded-circle"
                                                    />
                                                    &nbsp;&nbsp;
                                                <div class="ms-3">
                                                  <p class="fw-bold mb-1">{{operations.informed.nom}}</p>

                                                </div>
                                              </div>
                                            </td>
                                          </tr>
                                        </tbody>
                                      </table>
                                    <hr/>
              <table class="table align-middle mb-0 bg-white table-responsive">
                <thead class="bg-light">
                  <tr>
                    <th>Op&eacute;ration Attribu&eacute; &agrave; :</th>
                    <th>Date Affectation</th>
                    <th>Priorit&eacute</th>
                    <th>Ech&eacute;nce</th>

                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td>
                      <div class="d-flex align-items-center">
                        <img
                            src="{{ operations.personnel.photo.url }}"
                            alt=""
                            style="width: 45px; height: 45px"
                            class="rounded-circle"
                            />
                            &nbsp;&nbsp;
                        <div class="ms-3">
                          <p class="fw-bold mb-1">{{operations.personnel.nom}}</p>
                          <p class="text-muted mb-0">{{operations.personnel.mail}}</p>
                        </div>
                      </div>
                    </td>
                    <td>
                      <p class="fw-normal mb-1">{{operations.date_creation}}</p>
                      <p class="text-muted mb-0"> ({{operations.date_creation|naturaltime}})</p>
                    </td>
                    <td>
                      <span class="badge badge-success rounded-pill d-inline">{{operations.priorite}}</span>
                    </td>
                    <td>{{operations.date_echeance}}</td>

                  </tr>


                </tbody>
              </table>
              <hr/>
              <table  class="table align-middle mb-0 bg-white table-responsive">
                <thead class="bg-light">
                  <tr>
                    <th>Commentaire(s) Faite(s) Par:</th>
                    <th>Commentaire</th>
                    <th>Date Commentaire</th>
                    {%if operation.file|length == '0'%}
                    {%else%}

                    <th>Fichier Joint</th>
                    {%endif%}
                  </tr>
                </thead>
                <tbody>
              {%for operation_historics in operation_historic%}
              {%if operation_historics.m_operation_id == operations.id%}
                  <tr>
                    <td>
                      <div class="d-flex align-items-center">
                        <img
                            src="{{operation_historics.personnel.photo.url}}"
                            alt=""
                            style="width: 45px; height: 45px"
                            class="rounded-circle"
                            />
                        <div class="ms-3">

                            <p class="text-muted fw-bold mb-1" style="font-family:quartz">{{operation_historics.m_role}}</p>
                          <p class="text-muted mb-0" style="font-family:quartz">{{operation_historics.personnel.mail}}</p>

                        </div>
                      </div>
                    </td>
                    <td>
                     <p class="fw-normal mb-1"></p>
                      <p class="text-muted mb-0">{{operation_historics.m_commentaire}}</p>
                    </td>
                    <td>
                      <span class="d-inline">{{ operation_historics.m_date_realisation }}</span>

                     ({{ operation_historics.m_date_realisation|naturaltime }})
                    </td>

                  <td>

 <a  href="operation_file/{{ operation_historics.id }}">
    <a href="/download_files/{{operation_historics.id}}"> {{operation_historics.file}}</a>
</a>


</td>
                     </tr>
              {%endif%}
              {%endfor%}

                </tbody>
              </table>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-danger" data-dismiss="modal">Fermer</button>

            </div>
          </div>
        </div>
      </div>
      <div class="modal fade" id="staticBackdrop21{{ operations.id }}" data-backdrop="static" data-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-lg">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="staticBackdropLabel">{{ request.user.personnel.nom }} Faites Un Commentaire Pour L'op&eacute;ration: <b class="text-primary">{{operations.nom}}</b></h5>
              <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
              </button>
            </div>
            <div class="modal-body">
           <form method="POST" action="/save_comment/" enctype="multipart/form-data">
                                            {%csrf_token%}
                                        <div class="modal-body">
                                            <label class="text-danger">Votre Commentaire *</label>
                                            <textarea class="form-control"name="commentaire"></textarea>
                                             <label class="text-primary">Attachez Un fichier</label>
                                            <input type="file" class="form-control" name="file">

                                              <label class="text-danger">Destinataire *</label>
                                            <input type="hidden" value='{{ operations.id }}' class="form-control" name="operation_id">

                                           <input type="text" class="form-control" name="role" value="{{ operations.personnel.nom }}" style="display: none">
                                                  <select class="form-control" name="email">
                                                    <option> Selectionnez Le destinataire</option>
                                                      {%for personnels in personnel%}
                                                    <option value="{{personnels.mail}}">{{personnels.mail}}<b class="text-danger" style="font-style: italic;">|{{personnels.nom}}</b></option>
                                                    {%endfor%}
                                                  </select>



                                        </div>
                                        <div class="modal-footer">
                                          <button type="button" class="btn btn-secondary" data-dismiss="modal">Fermer</button>
                                          <button type="submit" class="btn btn-primary">Soumettre</button>
                                        </div>
                                    </form>
                                  </div>
          </div>
        </div>
      </div>
    {% endfor %}
  </div>
</div>


	{% for message in messages %}
   <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
   {% if message.tags == 'success' %}
    <script>
        swal("info!", "{{ message }}", "info");
    </script>

   {% endif %}
{% endfor %}

  	<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script type="text/javascript">
  $(document).ready(function() {
    $('#search').on('input', function() {
        var searchText = $(this).val().toLowerCase();
        $('.flexcard').each(function() {
            var operationName = $(this).find('.flexcardText').text().toLowerCase();
            if (operationName.includes(searchText)) {
                $(this).show();
            } else {
                $(this).hide();
            }
        });
    });
});


</script>

<script type="text/javascript" src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script type="text/javascript">
  $(document).ready(function() {
    // Masquer les éléments au chargement de la page
    $('.cardAll').hide();

    // Fonction pour basculer les éléments et changer le texte du bouton
    function toggleSearchElements() {
      $('.cardAll').toggle('slow');
      var buttonText = $('.btn-dark').text();
      if (buttonText.trim() === "Masquer Options De Recherche") {
        $('.btn-dark').text("Afficher Options De Recherche");

      } else {
        $('.btn-dark').text("Masquer Options De Recherche");
      }
    }

    // Attacher la fonction à un événement, par exemple un clic sur un bouton
    $('.btn-dark').click(function() {
      toggleSearchElements();
    });
  });
</script>

<script type="text/javascript">
$(document).ready(function() {
    $('#filter_personnel').on('change', function() {
        var selectedPersonnel = $(this).val().trim().toLowerCase();

        $('.flexcard').each(function() {
            var personnelName = $(this).find('.flexcardText').text().trim().toLowerCase();

            if (selectedPersonnel === 'selectionnez le responsible' || personnelName.includes(selectedPersonnel)) {
                $(this).show();
            } else {
                $(this).hide();
            }
        });
    });
});
</script>


{% endblock %}
