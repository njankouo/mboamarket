{% extends './decision.html' %}
{% load static %}
{% load humanize %}
{% block content %}

<div class="container-fluid">
<div class="row">
<div class="col-md-12 mt-5">
<div class="card">
	
	<div class="card-title">
		
			<h5 class="text-success my-2 mx-3" style="font-weight: bold;">Rapport Valid&eacute;:<b>
				{% for operation_rapports in operation_rapport%}
					{%if operation_rapports.operation_id == operation.id%}
					<a href="/view/file/{{operation_rapports.id}}">	{{operation_rapports.piece_jointe}}</a>
					{%else%}

					{%endif%}
				{%endfor%}
			</b></h5>

	</div>
<div class="card-body">
	<button type="button" class="btn btn-primary my-2" data-bs-toggle="modal" data-bs-target="#staticBackdrop" style="float:right">
		Votre avis
	  </button>
	  
	  <button class="btn btn-danger rejeterButton" data-bs-toggle="modal" data-bs-target="#exampleModal{{ operation.id }}">Rejeter Rapport</button>
	  
<table class="table align-middle mb-0  table-responsive text-center w-100 table-responsive">
	<thead class="bg-dark">
	  <tr>
		<th class="text-light" style="width:25%">R:&nbsp;&nbsp;{{operation.personnel}}</th>
		<th class="text-light" style=""width:25%">A:&nbsp;&nbsp; {{operation.accountable}}</th>
		<th class="text-light" style="width:25%">C:&nbsp;&nbsp; {{operation.consulted}}</th>
		<th class="text-light" style="width:25%">I: &nbsp;&nbsp;{{operation.informed}}</th>
		
	  </tr>
	</thead>
	<tbody>
	  <tr>
		<td>
		  <div class="d-flex align-items-center">
			<img
				src="{{ operation.personnel.photo.url }}"
				alt=""
				style="width: 45px; height: 45px"
				class="rounded-circle"
				/>
				&nbsp;&nbsp;
			<div class="ms-3">
			 
			  <p class="text-muted mb-0">{{operation.personnel.mail}}</p>
			</div>
		  </div>
		</td>
		<td>
			<div class="d-flex align-items-center">
				<img
					src="{{ operation.accountable.photo.url }}"
					alt=""
					style="width: 45px; height: 45px"
					class="rounded-circle"
					/>
					&nbsp;&nbsp;
					<div class="ms-3">
			
			<p class="text-muted mb-0">{{operation.accountable.mail}}</p>
					</div>
				</div>
		</td>
		<td>
		  
			<div class="d-flex align-items-center">
				<img
					src="{{ operation.consulted.photo.url }}"
					alt=""
					style="width: 45px; height: 45px"
					class="rounded-circle"
					/>
					&nbsp;&nbsp;
					<div class="ms-3">
			
			<p class="text-muted mb-0">{{operation.consulted}}</p>
					</div>
				</div>
		</td>
		<td>
			<div class="d-flex align-items-center">
				<img
					src="{{ operation.informed.photo.url }}"
					alt=""
					style="width: 45px; height: 45px"
					class="rounded-circle"
					/>
					&nbsp;&nbsp;
					<div class="ms-3">
		
			<p class="text-muted mb-0">{{operation.informed}}</p>
					</div>
				</div>
		</td>
		
	  </tr>
	
	 
	</tbody>
  </table>

  <hr/>

<h6  style=" font-weight:bold;text-transform:uppercase; font-weight:bold;font-family:quartz" class="text-center text-primary">HISTORISATION DE L'OP&eacute;ration</h6>


		 <div class="modal fade" id="exampleModal{{ operation.id }}" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
			<div class="modal-dialog" role="document">
			  <div class="modal-content">
				<div class="modal-header">
				  <!-- <h5 class="modal-title" id="exampleModalLabel">Modal title</h5> -->
				  <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close">
					</button>
				</div>
		  
		<div class="modal-body">
			<b class="text-danger">
			Êtes-vous sûr(e) de vouloir rej&eacute;ter ce rapport?
			Vous ne pourrez pas revenir en arrière !</b>
			
		</div>
		<div class="modal-footer">
		  <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" id="nonButton">Non,Annuler</button>
		
		  <button type="button" class="btn btn-primary"  data-bs-toggle="modal" data-bs-target="#staticBackdrop1{{ operation.id }}">Oui,Rejeter</button>
	
		</div>
	  </div>
	</div>
  </div>
  <div class="modal fade" id="staticBackdrop1{{ operation.id }}" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
	<div class="modal-dialog" role="document">
	  <div class="modal-content">
		<div class="modal-header">
		  <h5 class="modal-title" id="exampleModalLabel">Motif Du Rejet</h5>
		  <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close">
			</button>
		</div>
  
  <!-- <div class="modal fade" id="staticBackdrop1{{ operation.id }}" data-backdrop="static" data-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
	<div class="modal-dialog">
	  <div class="modal-content">
		<div class="modal-header">
		  <h5 class="modal-title" id="staticBackdropLabel">Motif Du Rejet</h5>
		  <button type="button" class="close" data-dismiss="modal" aria-label="Close">
			<span aria-hidden="true">&times;</span>
		  </button>
		</div> -->
		<div class="modal-body">
			<form method="POST" action="/rejet_rapport/{{ operation.id }}">
				{%csrf_token%} 
			<label class="text-primary" style="font-weight:bold">D&eacute;crivez Le Motif Du Projet</label>
		  <textarea class="form-control" name="commentaire"></textarea>
		  {%comment%}
		 <input type="email"  value="{{ operation.personnel.mail }}" style="display:none">
		 <input type="email"  value="{{ operation.accountable.mail }}" style="display:none">
		 <input type="email"  value="{{ operation.consulted.mail }}" style="display:none"> {% endcomment %}
		</div>
		<div class="modal-footer">
		  <button type="button" class="btn btn-danger" data-bs-dismiss="modal">Fermer</button>
		  <button type="submit" class="btn btn-success">Soumettre</button>
		</div>
	</form>
	  </div>
	</div>
  </div>

	  <div class="modal fade" id="staticBackdrop" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
		<div class="modal-dialog" role="document">
		  <div class="modal-content">
			<div class="modal-header">
			
			  <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close">
				</button>
			</div>
	  
      <div class="modal-body">
     										<form method="POST" action="/avis_inform/">
										{% csrf_token %}
										
										<input type="hidden" name="operation" value="{{operation.id}}">
										<input type="hidden" name="email1" value='{{ operation.accountable.mail }}'>
										<input type="hidden" name="email2" value='{{ operation.personnel.mail }}'>
										<input type="hidden" name="email3" value='{{ operation.informed.mail }}'>
										<input type="hidden" name="email4" value='{{ operation.consulted.mail }}'>
										<input type="hidden" name="nb_stars" id="nb_stars">
									<h5 style="font-weight:bold;font-family:quartz" class="text-primary"> Votre Avis( sur 5 Etoiles )</h5>
									<div class="starDiv d-flex">
										<div>
											<i data-id="1" class="fas fa-star"></i>
										</div>

										<div>
											<i data-id="2" class="fas fa-star"></i>
										</div>
										<div>
											<i data-id="3" class="fas fa-star"></i>
										</div>
										<div>
											<i data-id="4" class="fas fa-star"></i>
										</div>
										<div>
											<i data-id="5" class="fas fa-star"></i>
										</div>
										<div id="note" style="font-weight:bold;font-family:quartz;text-transform:capitalize" class="text-primary"></div>
									</div>
									<div>
										<textarea class="form-control" name="observations"  rows="6"></textarea>
																			</div>
									


      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fermer</button>
        <button type="submit" class="btn btn-primary">Soumettre</button>
      </div>
</form>
    </div>
  </div>
</div>

<table class="table table-hover table-responsive-xl text-center" style="width:100%">
<caption style="font-weight:bold;text-transform:uppercase">operation affect&eacute;e {{operation.date_creation|naturaltime}}</caption>
  <thead style="text-transform: uppercase;" class="badge-primary text-light text-center bg-dark">
    <tr>
      <th style="width:25%" class="text-light">Date</th>
   <th style="width:25%" class="text-light">Responsables</th>
      <th style="width:50%" class="text-light">Commentaires</th>

   
     </tr>
  </thead>
  <tbody>

{% for operation_historics in operation_historic%}
{%if operation_historics.m_operation_id == operation.id%}
    <tr>
	
     <td>{{operation_historics.m_date_realisation}}</td>
{%if operation_historics.m_role == "A"%}
<td class="text-danger" style="font-weight:bold">

{{operation_historics.m_role}}:
Accountable
</td>
{%elif operation_historics.m_role == "R"%}
<td class="text-primary" style="font-weight:bold">

{{operation_historics.m_role}}:
Responsible
</td>
{%elif operation_historics.m_role == "C"%}
<td class="text-warning" style="font-weight:bold">

{{operation_historics.m_role}}:
Consulted
</td>
{%elif operation_historics.m_role == "I"%}
<td class="text-danger" style="font-weight:bold">

{{operation_historics.m_role}}
Informed
</td>

{%endif%}

     <td style="font-weight:bold">{{operation_historics.m_commentaire}}</td>

{%comment%}
     <td>
{%if operation_historics.m_role == "R"%}
{% if actual_institution.default_options == True %}

										{% else %}
										{% for elt in operation_rapport.aggregate_values %}
										<div class="d-flex my-2">
										
												{% if elt.type == 'file' %}
												
													<div>
														<a href="{{elt.value.m_file.url}}"><i class="fas fa-file"></i>
														{{elt.value.m_file}}</a>
													</div>
												
											
												
																								{% endif %}
											</div>
										{% endfor %}

										{% endif %}
{%else%}
<a href="/operation_file/{{ operation_historics.id }}">
{{operation_historics.file}}</a>

{% endif %}

</td>
 {%endcomment%}
{%endif%}
{%empty%}
	<td colspan="3">
	<h6 style="font-weight:bold" class="text-center text-danger" >Aucun Historique Pour L'instant</h6>

	</td>
    </tr>
{%endfor%}
     </tbody>
</table>
</div>
	</div>
</div>							
</div>
</div>
									
</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script>

$(document).ready(function() {
  $('.starDiv i').click(function() {
    var nbStars = $(this).data('id');
    // Calculer la note sur 5 en fonction du nombre d'Ã©toiles sÃ©lectionnÃ©es
    var note = nbStars + " / 5";
    $('#note').text('Vous Attribuez Une Note De : ' + note,'Pour Cette Operation');
  });
});

</script>
 <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

 <script>
    document.getElementById('nonButton').addEventListener('click', function() {
      Swal.fire({
        title: "Information",
       
        html: '<p>Votre rapport est en sécurité :)</p><span style="font-size: 3em">👍</span>' // Utilisez l'icône directement dans le HTML de la boîte de dialogue
      });
    });
  </script>
<script>
    // Fonction pour fermer le premier modal lors du clic pour ouvrir le deuxième modal
    $('#exampleModal{{ operation.id }}').on('show.bs.modal', function (e) {
        $('#staticBackdrop1{{ operation.id }}').modal('hide'); // Ferme le premier modal
    });
</script>





{% endblock %}


